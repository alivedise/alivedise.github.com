<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Ascheriit]]></title>
  <link href="http://alivedise.github.com/atom.xml" rel="self"/>
  <link href="http://alivedise.github.com/"/>
  <updated>2013-07-19T18:07:10+08:00</updated>
  <id>http://alivedise.github.com/</id>
  <author>
    <name><![CDATA[Alive Kuo]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[FxOS] Plan: Window Management decoupling (CONT.)]]></title>
    <link href="http://alivedise.github.com/blog/2013/07/18/window-manager-decoupling/"/>
    <updated>2013-07-18T17:33:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2013/07/18/window-manager-decoupling</id>
    <content type="html"><![CDATA[<p><img src="http://i.imgur.com/T0pyFFc.jpg"></p>

<p>Following are the plan about why and how to split current Gaia:System:Window Manager.</p>

<h2>Sources/Links</h2>

<ul>
<li><a href="https://github.com/mozilla-b2g/gaia/blob/master/apps/system/js/window_manager.js">Window Manager source</a></li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=845251">Window Manager testable meta bug</a></li>
</ul>


<h2>Current main functions in Window Manager</h2>

<ul>
<li>App Window Management</li>
<li>Crash Management</li>
<li>Clear browser data</li>
<li>Wrapper Window Management</li>
<li>Inline Activity Management</li>
<li>Homescreen Management</li>
<li>MozBrowser Element Generation</li>
<li>Orientation Management</li>
<li>Visibility Management</li>
<li>Resize Management</li>
<li>App Screenshots Management [deprecated]</li>
<li>System Message Handler</li>
<li>Open app transition</li>
<li>Close app transition</li>
<li>System Message Handler</li>
<li>FTU Management [deprecated! Become standalone FTU Launcher already!]</li>
</ul>


<p>So which could be pulled out to reduce the heavy weight?</p>

<h3>Inline Activity Management -> App Window</h3>

<p>Inline Activity Management should belong to the activity caller.</p>

<p>If app A opens a page(open.html) of app B as an inline activity,
the life cycle of activity callee is based on app A instead of app B.</p>

<p>Thus, if app A is killed or closed, the activity opened by app A should be killed.</p>

<p>But if app B(index.html) is killed, activity B(open.html) shouldn&#8217;t be affected.</p>

<h3>Resize Management</h3>

<p>Resize is another duty of the app window instance itself.</p>

<p>If we&#8217;re moving the activity into the app window, we could</p>

<ol>
<li>Recursively call current activity callee&#8217;s resize function until the last callee is found.</li>
<li>Resize all activity callee on top of current app window.</li>
</ol>


<p>in the app window&#8217;s resize function.</p>

<h3>Visibility Management</h3>

<p>App window would have 2 kind of &#8220;child-like&#8221; window instance:
* <code>var childWindow = window.open</code>
* <code>new MozActivity</code></p>

<p>Currently we don&#8217;t send of the caller correctly to background on these two cases.</p>

<p>The reasons are:</p>

<ol>
<li>Memory concern. Part of our memory management model relies on the page visibility state. Backgrounded app has higher possibility to be killed. We shall review and refine this soon. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=892371">https://bugzilla.mozilla.org/show_bug.cgi?id=892371</a>.</li>
<li>Backgrounded app is totally invisible instead of keeping the cached image frame. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=825174">https://bugzilla.mozilla.org/show_bug.cgi?id=825174</a></li>
</ol>


<h3>Oreintation Management</h3>

<p>App could specify the native orientation from manifest&#8217;s orientation field.
So from this point it is an instance specific value.</p>

<p>What&#8217;s tricky here is:</p>

<ol>
<li>Orientation indeed isn&#8217;t app specific API. Any app at any time could call <code>lockOrientation</code> of &#8216;screen&#8217; object. Thus it would affect the other apps.</li>
<li>What we should do is preventing app from locking/unlocking orientation when they&#8217;re background.</li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=840147">Orientation behavior is bind to app transtion UX.</a></li>
<li>We will discuss this more detailly in app window design.</li>
</ol>


<h3>Homescreen Management</h3>

<p>Window Manager is the one who manipulates hardware or software home button event.</p>

<p>We should leave this part in Window Manager but let Homescreen Window manages itself.</p>

<p>To manage itself means that:
* Generate the mozbrowser iframe by itself.
* Fetch homescreen manifest by the manifestURL storing at settings on its own.
* Revive itself when it&#8217;s killed in background. (Different behavior than other apps.)</p>

<p>So it&#8217;s worthy to have an specific app window singleton for homescreen app.</p>

<h3>Wrapper Management</h3>

<p>This is another special type of app window.
It&#8217;s opened via homescreen; it stands for the app who has no manifestURL but a pure web page.</p>

<p>We should have a new WrapperWindow class inherited from AppWindow class.</p>

<h3>mozbrowser iframe generation</h3>

<p>All kind of window needs one mozbrowser iframe with different attributes fed to.</p>

<p>The element should be generated in <code>BrowserFrame</code> in configuration pattern.</p>

<h3>Open/Close transition</h3>

<p>This is the most important part of a window UI.</p>

<p>There&#8217;re many things relying on the transition state to take progress.</p>

<p>We&#8217;re discussing it in previous article, and would review this implementation soon.</p>

<h3>System Message Handler</h3>

<p>Now system message is used for opening the target app if it&#8217;s not opened.
There&#8217;re two cases: activity and non-activity.</p>

<p>This should be left in Window Manager.</p>

<h3>Crash management</h3>

<ul>
<li>For crash of app window, let it decides what it wants to do when it sees crash event.</li>
<li>For crash of opened window or activivity, let its caller decides what to do.</li>
</ul>


<h3>Clear browser data</h3>

<p>Totally safe enough to move to another module.
Irrevalant to manage windows.</p>

<h3>Screenshot Management</h3>

<p>Since the screenshot now is only touched by app window and cards view,
let app window expose its screenshot to cards view.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Fx OS] Background media play]]></title>
    <link href="http://alivedise.github.com/blog/2013/07/16/audio-competing-in-fxos/"/>
    <updated>2013-07-16T19:16:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2013/07/16/audio-competing-in-fxos</id>
    <content type="html"><![CDATA[<p><img src="https://blog.mozilla.org/press/files/2012/09/FXOS_Music_Grid.jpg"></p>

<p>If you want to have you own media playing app to be able to run at background,
and/or has the ability to interrupt other playing audio, please view this article for what to do.</p>

<h2>Audio Channel Permission</h2>

<p>You need to specify this permission in the manifest of your app.</p>

<p>And yes, this means we don&#8217;t allow a web page without the manifest to play at background.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s2">&quot;permissions&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;audio-channel-content&quot;</span><span class="o">:</span> <span class="p">{}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>content</code> represents the name of the audio channel.</p>

<p>Note: Video&#8217;s permission also uses the same <code>audio-channel-content</code>.</p>

<h3>Audio Channel Types</h3>

<p>We have five audio channels currently:</p>

<ul>
<li><code>normal</code>: Default channel of any media element, including video.</li>
<li><code>content</code>: Especailly stands for content like music.</li>
<li><code>notification</code>: Include desktop-notification sounds</li>
<li><code>ringer</code>: Incoming call ringer</li>
<li><code>alarm</code>: Alarm has a specific requirement to interrupt any other channel above.</li>
<li><code>telephony</code>: Voice.</li>
</ul>


<h4>Volume Settings</h4>

<ul>
<li>Normal and content channel are sharing the same volume settings.</li>
<li>Notification and ringer are another set.</li>
<li>Other has its own settings key.</li>
</ul>


<h3>Audio Competing Rules</h3>

<ol>
<li>We&#8217;re interrupting the lower channel when higher channel occurs.</li>
<li>If the same channel are playing and using content channel,
the one who gets visibility (go to foreground) would be the winner.</li>
<li>The foreground page/app is always playable. However the channel type decides it could interrupt background playing content or not.</li>
<li>The background page/app is playable if and only if the background is causing by screen off,
and the page/app is the current displayed one.</li>
</ol>


<p>I would explain the rules more in another article ;)</p>

<h2>[Statically] HTML Media Element</h2>

<p>You could assign audio channel type to the media elements in HTML.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;audio</span> <span class="na">mozaudiochannel=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;&lt;/audio&gt;</span>
</span><span class='line'><span class="nt">&lt;video</span> <span class="na">mozaudiochannel=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;&lt;/video&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Please keep in mind you need relevant channel permission.</p>

<blockquote><p>Note: It&#8217;s <code>mozaudiochannel</code> instead of <code>mozaudiopchanneltype</code> here.</p></blockquote>


<h2>[Dynamically] Javascript</h2>

<p>Sometimes we need to dynamically generate the player element:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">audio</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Audio</span><span class="p">();</span>
</span><span class='line'><span class="nx">audio</span><span class="p">.</span><span class="nx">mozAudioChannelType</span> <span class="o">=</span> <span class="s1">&#39;content&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Set audio channel type before setting src to avoid decoder confuses.</span>
</span><span class='line'><span class="nx">audio</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">&#39;xxx.ogg&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Change the channel of the audio to another type is not allowed.</p>

<p>You should create another audio/video instance if you want to be played in another channel.</p>

<h2>(OPTIONAL) If you want to know you&#8217;re interrupted by higher channel</h2>

<p>Add mozinterruptbegin/mozinterruptend event handler if you need to do something with interruptions.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;audio#my-player&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="c1">// The event is fired on the media element. </span>
</span><span class='line'>  <span class="nx">player</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mozinterruptbegin&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">onInterrupted</span><span class="p">()</span> <span class="p">{</span><span class="c1">//do sth....}); </span>
</span><span class='line'>  <span class="nx">player</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mozinterruptend&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">onResumed</span><span class="p">()</span> <span class="p">{</span><span class="c1">// do sth....}); </span>
</span></code></pre></td></tr></table></div></figure>


<h2>Notices</h2>

<ul>
<li>Even if your are developing a HTML5 video playing app,
and we all know that video shouldn&#8217;t be played at background due to strange UX,
you should also consider to set content channel because video is expected to interrupt the current background playing media.</li>
</ul>


<h2>Reference</h2>

<ul>
<li><a href="https://wiki.mozilla.org/WebAPI/AudioChannels">Mozilla WIKI: Audio Channel</a></li>
<li><a href="https://groups.google.com/forum/?fromgroups=#!topic/mozilla.dev.gaia/HyAlHdFdX68">B2G Maillist</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Proposal: System Modualization Plan]]></title>
    <link href="http://alivedise.github.com/blog/2013/07/10/system-modulization-plan/"/>
    <updated>2013-07-10T18:04:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2013/07/10/system-modulization-plan</id>
    <content type="html"><![CDATA[<h4>Source</h4>

<p><a href="https://github.com/mozilla-b2g/gaia/tree/master/apps/system">https://github.com/mozilla-b2g/gaia/tree/master/apps/system</a></p>

<h4>Issues with Modulization-less</h4>

<ol>
<li>Some modules directly invokes others.</li>
<li><code>'LockScreen is undefined.'</code> message appears oftenly right after device boots up.</li>
<li>Memory concern - Most of the modules are not always needed. Most of the UI view doesn&#8217;t need to live in the DOM tree at first.</li>
<li>Performance concern - device bootup time is getting longer and longer.</li>
</ol>


<h4>Proposal: Core modules and side modules</h4>

<p>We could figure out what&#8217;s definitely necessary in an operating system and what&#8217;s not.
For example, <code>Window Management</code> relevant modules should be a core module but <code>Captive Portal</code> shouldn&#8217;t be.</p>

<p>The main idea is the same as any other app performanace tuning:
Lazy load anything on demand.</p>

<p>The key to this idea would be to establish the following rules:
* Any side module would have a main event by interest.
* An event dispatcher as a core module to gather all main events of side modules and then lazy load them.
For example, lazy load the Captive Portal:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mozChromeEvent&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;captive-portal-login&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">CaptivePortal</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">lazy</span><span class="o">-</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;captive-portal&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">onReadyCallback</span><span class="p">()</span> <span class="p">{</span>   <span class="c1">// lazy load captive portal and its HTML part.</span>
</span><span class='line'>      <span class="nx">CaptivePortal</span><span class="p">.</span><span class="nx">handleEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>  <span class="c1">// Pass the event</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>  <span class="c1">// If we have already load the CaptivePortal, the event listener inside CP would catch the event by itself.</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>So another rule would be:
* expose handleEvent in any side module for Event Dispatcher to invoke when they are firt time loaded by Event Dispatcher.</p>

<p>With this, we could even lazy load lockscreen,
because if lockscreen is disabled by the user, we don&#8217;t need to load it when the device boots.</p>

<p>IMO there&#8217;re only few core modules now:</p>

<ul>
<li>Window Management

<ul>
<li>App Window</li>
<li>Browser Frame</li>
</ul>
</li>
<li>Utility-tray</li>
<li>Statusbar</li>
<li>Init Logo Handler (But this is useless after device boot finishes.)</li>
<li>Screen Management (Exactly, it&#8217;s indeed Wake Lock Management)</li>
<li>Applications (API Wrapper for mozApp)</li>
</ul>


<p>The following are API wrappers which I believe is also important enough to be a core module.</p>

<ul>
<li>Hardware Button Management (Many other modules&#8217; execution route is started here.)</li>
<li>Battery Management (UI-less but more like an API wrapper for mozBattery so I would put this into core module.)</li>
<li>Airplane Mode (API Wrapper of mozSettings: radio.enabled)</li>
<li>Bluetooth (API Wrapper for mozBluetooth)</li>
<li>Cost Control (It already lives inside an iframe.)</li>
<li>Ftu Launcher (Necessary only for one time when device is first time booted.)</li>
<li>Keyboard Management</li>
<li>mouse2touch</li>
<li>Notifications</li>
<li>Orientation observer (API Wrapper for deviceorientation event)</li>
<li>Sound manager (There are too many events involed here.)</li>
<li>Update Management</li>
</ul>


<h5>Chanllenge</h5>

<p>If we want to &#8220;unload&#8221; the module and its view using iframe,
we need a way for modules inside iframe to communicate.
The first thing come to my mind is <code>window.parent.postMessage</code></p>

<p>Second, we need to consider dependency problems if it&#8217;s too complex.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Window Management] Transition state machine]]></title>
    <link href="http://alivedise.github.com/blog/2013/07/05/transition-state-machine/"/>
    <updated>2013-07-05T14:53:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2013/07/05/transition-state-machine</id>
    <content type="html"><![CDATA[<p>The article is inspired by Tim&#8217;s <a href="http://blog.timc.idv.tw/posts/css-classes-state-machine-puzzle/">CSS Classes State Machine Puzzle</a>.</p>

<p>We had some frustrations all the times, on animating a window correctly.</p>

<p>Recently I try to dedicate on solving the puzzle.
But at first I need to apologize for my poor knowledge and thought about css transitions using class names.</p>

<p>In the past I usually thought it was stupid to use class list to control the style.
I thought it was ambiguous and strange if we ran into a situation that there&#8217;re more than one classes of same type put on one element. And an element full of different class names for different purposes may conflict. Recently I see <a href="https://github.com/h5bp/Effeckt.css">Effeckt</a> and know this is the trend: a simple class name stands for a kind of animation.</p>

<p>The real problem is that we should never put wrong class on the DOM element, in javascript. So this now turns to be a pure javascript puzzle.</p>

<p>We know, that, in certain moment, the app window is always in a specific state A, not B nor C. So what&#8217;s the problem? It&#8217;s how could we switch the state correctly.</p>

<p>Let&#8217;s create a real state machine in javascript!</p>

<p>So far it doesn&#8217;t take times for us to figure out that a window should have 4 basic transition state: <code>closed</code>, <code>opening</code>, <code>opened</code>, <code>closing</code>.</p>

<p>A basic transition life cycle of a window could be:</p>

<blockquote><p>(initial) -> closed -> opening -> opened &#8212;&#8212;> closing -> opening &#8212;&#8212;> &#8230;.</p></blockquote>


<p>Now we have 4 states, the next is what&#8217;s the trigger to states switching?</p>

<p>In finite state machine, what triggers state change is named for <a href="https://en.wikipedia.org/wiki/Finite-state_machine">&#8216;event&#8217;</a>.</p>

<p>We know that at least we have 2 events: &#8216;open&#8217; and &#8216;close&#8217;.</p>

<ul>
<li>&#8216;open&#8217; would trigger <code>closed</code> switches to <code>opening</code></li>
<li>&#8216;close&#8217; would trigger <code>opened</code> switches to <code>closing</code></li>
<li>If we sends &#8216;open&#8217; event into the state machine continously,
the second event would be ignored.
(Exactly it depends on what policy we choose. For example, we could devide &#8216;opening&#8217; state into &#8216;opening-part-1&#8217; and &#8216;opening-part-2&#8217; states. And implement the async state change. But if we need s two-state opening, it sounds like a CSS design problem to me. Let&#8217;s discuss this later if necessary.)</li>
<li>In order to gurantee the transition does really end and thus being independent from the &#8216;animationend&#8217; event(The event here is HTML DOM Event), we need to add a timer between &#8216;opening&#8217; and &#8216;opened&#8217; state. Also between &#8216;closing&#8217; and &#8216;closed&#8217; state.</li>
<li>Let&#8217;s call the new event &#8216;timeout&#8217;, the timing we set the timer is right after the transitioning from &#8216;closed&#8217; to &#8216;opening&#8217;, and from &#8216;opened&#8217; to &#8216;closing&#8217; successfully occurs.</li>
<li>For some use case we may want to cancel the transition. The &#8216;cancel&#8217; event is only valid in &#8216;opening&#8217; and &#8216;closing&#8217; state.</li>
</ul>


<p>So far, the state machine for transition we have:
<img src="http://i.imgur.com/MmBj2pY.jpg"></p>

<p>Now the problem is, how to represent this machine in javascript?</p>

<p>My anwser is put every transition relevant functions/attributes in another mixin object, which would be mixed into appWindow.prototype:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">capitalize</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">string</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">string</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * This object declares all transition event enum:</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * * OPEN</span>
</span><span class='line'><span class="cm">   * * CLOSE</span>
</span><span class='line'><span class="cm">   * * FINISH</span>
</span><span class='line'><span class="cm">   * * END</span>
</span><span class='line'><span class="cm">   * * CANCEL</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * @static</span>
</span><span class='line'><span class="cm">   * @namespace TransitionEvent</span>
</span><span class='line'><span class="cm">   * @type {Object}</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">EVT</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">OPEN</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">CLOSE</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">FINISH</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">END</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">CANCEL</span><span class="o">:</span> <span class="mi">4</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">_EVTARRAY</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;OPEN&#39;</span><span class="p">,</span> <span class="s1">&#39;CLOSE&#39;</span><span class="p">,</span> <span class="s1">&#39;FINISH&#39;</span><span class="p">,</span> <span class="s1">&#39;END&#39;</span><span class="p">,</span> <span class="s1">&#39;CANCEL&#39;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Describe the transition state table.</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * @example</span>
</span><span class='line'><span class="cm">   * var toState = transitionTable[currentState][event];</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * The value &quot;null&quot; indicates that the transition won&#39;t happen.</span>
</span><span class='line'><span class="cm">   * </span>
</span><span class='line'><span class="cm">   * @type {Object}</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">transitionTable</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>              <span class="cm">/* OPEN|CLOSE|FINISH|END|CANCEL */</span>
</span><span class='line'>    <span class="s1">&#39;closed&#39;</span><span class="o">:</span>  <span class="p">[</span><span class="s1">&#39;opening&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">],</span>
</span><span class='line'>    <span class="s1">&#39;opened&#39;</span><span class="o">:</span>  <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;closing&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">],</span>
</span><span class='line'>    <span class="s1">&#39;closing&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;opened&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;closed&#39;</span><span class="p">,</span> <span class="s1">&#39;closed&#39;</span><span class="p">,</span> <span class="s1">&#39;opened&#39;</span><span class="p">],</span>
</span><span class='line'>    <span class="s1">&#39;opening&#39;</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;closed&#39;</span><span class="p">,</span> <span class="s1">&#39;opened&#39;</span><span class="p">,</span> <span class="s1">&#39;opened&#39;</span><span class="p">,</span> <span class="s1">&#39;closed&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * This provides methods and attributes used for transition state handling. It&#39;s not meant to</span>
</span><span class='line'><span class="cm">   * be used directly.</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * The finite state machine of transition is working as(being from normal state):</span>
</span><span class='line'><span class="cm">   * </span>
</span><span class='line'><span class="cm">   * * `closed`  ---*event* **OPEN** ----------------&gt; `opening`</span>
</span><span class='line'><span class="cm">   * * `opening` ---*event* **END/FINISH/CANCEL** ---&gt; `opened`</span>
</span><span class='line'><span class="cm">   * * `opened`  ---*event* **CLOSE** ---------------&gt; `closing`</span>
</span><span class='line'><span class="cm">   * * `closing` ---*event* **END/FINISH/CANCEL** ---&gt; `closed`</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * If you want to reuse this mixin in your object, you need to define these attributes: `this.element`</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * And these method: `this.setVisible()` `this.publish()`</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * The following callback functions are executed only when the transition state are successfully switched:</span>
</span><span class='line'><span class="cm">   * `_onOpen`</span>
</span><span class='line'><span class="cm">   * `_onClose`</span>
</span><span class='line'><span class="cm">   * `_onEnd`</span>
</span><span class='line'><span class="cm">   * `_onFinish`</span>
</span><span class='line'><span class="cm">   * `_onCancel`</span>
</span><span class='line'><span class="cm">   * `_leaveOpened`</span>
</span><span class='line'><span class="cm">   * `_enterOpened`</span>
</span><span class='line'><span class="cm">   * `_leaveClosed`</span>
</span><span class='line'><span class="cm">   * `_enterClosed`</span>
</span><span class='line'><span class="cm">   * `_leaveClosing`</span>
</span><span class='line'><span class="cm">   * `_enterClosing`</span>
</span><span class='line'><span class="cm">   * `_leaveOpening`</span>
</span><span class='line'><span class="cm">   * `_enterOpening`</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * Every callback here is for internal usage and would be executed only once.</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * However you could utilize inner event in other functions.</span>
</span><span class='line'><span class="cm">   * </span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * @mixin WindowTransition</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * @event AppWindow#_onTransitionOpen</span>
</span><span class='line'><span class="cm">   * @private</span>
</span><span class='line'><span class="cm">   * @memberof AppWindow</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * @event AppWindow#_onTransitionClose</span>
</span><span class='line'><span class="cm">   * @private</span>
</span><span class='line'><span class="cm">   * @memberof AppWindow</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * @event AppWindow#_onTransitionEnd</span>
</span><span class='line'><span class="cm">   * @private</span>
</span><span class='line'><span class="cm">   * @memberof AppWindow</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * @event AppWindow#_onTransitionFinish</span>
</span><span class='line'><span class="cm">   * @private</span>
</span><span class='line'><span class="cm">   * @memberof AppWindow</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * @event AppWindow#_onTransitionCancel</span>
</span><span class='line'><span class="cm">   * @private</span>
</span><span class='line'><span class="cm">   * @memberof AppWindow</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">WindowTransition</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">TRANSITION_EVENT</span><span class="o">:</span> <span class="nx">EVT</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * _transitionState indicates current transition state of appWindow.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * @memberOf WindowTransition</span>
</span><span class='line'><span class="cm">     * @default</span>
</span><span class='line'><span class="cm">     * @type {String}</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="nx">_transitionState</span><span class="o">:</span> <span class="s1">&#39;closed&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Record the previous transition state.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * **Only updated if the state changes successfully.**</span>
</span><span class='line'><span class="cm">     * </span>
</span><span class='line'><span class="cm">     * @type {String|null}</span>
</span><span class='line'><span class="cm">     * @memberOf WindowTransition</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="nx">_previousTransitionState</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Handle the transition event.</span>
</span><span class='line'><span class="cm">     * @memberOf WindowTransition</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="nx">_transitionHandler</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">aw__transitionHandler</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_cancelTransition</span><span class="p">();</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_processTransitionEvent</span><span class="p">(</span><span class="nx">EVT</span><span class="p">.</span><span class="nx">FINISH</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">_cancelTransition</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">aw__cancelTransition</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">className</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;transition-&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">className</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">_enterOpening</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">aw__enterOpening</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="cm">/**</span>
</span><span class='line'><span class="cm">       * @todo set this._unloaded</span>
</span><span class='line'><span class="cm">       */</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">resize</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_unloaded</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//this.element.style.backgroundImage = &#39;url(&#39; + this._splash + &#39;)&#39;;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Turn of visibility once we&#39;re entering opening state.</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Make sure the transition is terminated.</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_openingTransitionTimer</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_previousTransitionState</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="nx">_previousTransitionState</span> <span class="o">==</span> <span class="nx">from</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="nx">_transitionState</span> <span class="o">==</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">this</span><span class="p">.</span><span class="nx">_processTransitionEvent</span><span class="p">(</span><span class="nx">EVT</span><span class="p">.</span><span class="nx">END</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">_transitionTimeout</span><span class="o">*</span><span class="mf">1.2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="cm">/**</span>
</span><span class='line'><span class="cm">       * @event AppWindow#appwillopen</span>
</span><span class='line'><span class="cm">       * @memberof AppWindow</span>
</span><span class='line'><span class="cm">       */</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">from</span> <span class="o">!==</span> <span class="s1">&#39;opened&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Only publish |willopen| event when previous state is &quot;closed&quot;.</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;willopen&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;transition-opening&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_transition</span><span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">_enterClosing</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">aw__enterClosing</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// Make sure the transition is terminated.</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_closingTransitionTimer</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_previousTransitionState</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="nx">_previousTransitionState</span> <span class="o">==</span> <span class="nx">from</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="nx">_transitionState</span> <span class="o">==</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">this</span><span class="p">.</span><span class="nx">_processTransitionEvent</span><span class="p">(</span><span class="nx">EVT</span><span class="p">.</span><span class="nx">END</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">_transitionTimeout</span><span class="o">*</span><span class="mf">1.2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="cm">/**</span>
</span><span class='line'><span class="cm">       * @event AppWindow#appwillclose</span>
</span><span class='line'><span class="cm">       * @memberof AppWindow</span>
</span><span class='line'><span class="cm">       */</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">from</span> <span class="o">!==</span> <span class="s1">&#39;opened&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Only publish |willclose| event when previous state is &quot;opened&quot;.</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;willclose&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;transition-closing&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_transition</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">_processTransitionEvent</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">aw__processTransitionEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">to</span> <span class="o">=</span> <span class="nx">transitionTable</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_transitionState</span><span class="p">][</span><span class="nx">evt</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">to</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_transitionState</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">leaveState</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">onEvent</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">enterState</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_previousTransitionState</span> <span class="o">=</span> <span class="nx">from</span><span class="p">;</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_transitionState</span> <span class="o">=</span> <span class="nx">to</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">enterState</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">aw_enterState</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">funcName</span> <span class="o">=</span> <span class="s1">&#39;_enter&#39;</span> <span class="o">+</span> <span class="nx">capitalize</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">());</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">funcName</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>          <span class="k">this</span><span class="p">[</span><span class="nx">funcName</span><span class="p">](</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">funcName</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">funcName</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">[</span><span class="nx">funcName</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>            <span class="nx">func</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">leaveState</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">aw_leaveState</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">funcName</span> <span class="o">=</span> <span class="s1">&#39;_leave&#39;</span> <span class="o">+</span> <span class="nx">capitalize</span><span class="p">(</span><span class="nx">from</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">());</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">funcName</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>          <span class="k">this</span><span class="p">[</span><span class="nx">funcName</span><span class="p">](</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">funcName</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">funcName</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">[</span><span class="nx">funcName</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>            <span class="nx">func</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">onEvent</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">aw_onEvent</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">funcName</span> <span class="o">=</span> <span class="s1">&#39;_onTransition&#39;</span> <span class="o">+</span> <span class="nx">capitalize</span><span class="p">(</span><span class="nx">_EVTARRAY</span><span class="p">[</span><span class="nx">evt</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">());</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_invoke</span><span class="p">(</span><span class="nx">funcName</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">_enterOpened</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">aw__enterOpened</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_cancelTransition</span><span class="p">();</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_openingTransitionTimer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">window</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_openingTransitionTimer</span><span class="p">);</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_openingTransitionTimer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="cm">/**</span>
</span><span class='line'><span class="cm">       * @event AppWindow#appopen</span>
</span><span class='line'><span class="cm">       * @memberOf AppWindow</span>
</span><span class='line'><span class="cm">       */</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">from</span> <span class="o">==</span> <span class="s1">&#39;opening&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Only publish |open| event when previous state is &quot;opening&quot;.</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">_enterClosed</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">aw__enterClosed</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_cancelTransition</span><span class="p">();</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_closingTransitionTimer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">window</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_closingTransitionTimer</span><span class="p">);</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_closingTransitionTimer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="cm">/**</span>
</span><span class='line'><span class="cm">       * @event AppWindow#appclose</span>
</span><span class='line'><span class="cm">       * @memberof AppWindow</span>
</span><span class='line'><span class="cm">       */</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">from</span> <span class="o">==</span> <span class="s1">&#39;closing&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Only publish |close| event when previous state is &quot;closing&quot;.</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Set the transition way of opening or closing transition.</span>
</span><span class='line'><span class="cm">     * @param  {String} type       &#39;open&#39; or &#39;close&#39;</span>
</span><span class='line'><span class="cm">     * @param  {String} transition The CSS rule name about window transition.</span>
</span><span class='line'><span class="cm">     * @memberOf WindowTransition</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="nx">_setTransition</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">aw__setTransition</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">transition</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">!=</span> <span class="s1">&#39;open&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">!=</span> <span class="s1">&#39;close&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_transition</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="nx">transition</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">AppWindow</span><span class="p">.</span><span class="nx">addMixin</span><span class="p">(</span><span class="nx">WindowTransition</span><span class="p">);</span>
</span><span class='line'><span class="p">}(</span><span class="k">this</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<h5>The state machine&#8217;s usage and notes</h5>

<ol>
<li>A single app window instance would send &#8216;open&#8217; and &#8216;close&#8217; event due to user action:
<code>
transitionStateMachine.<em>processEvent('open');
transitionStateMachine.</em>processEvent('close');
</code>
Note, app window doesn&#8217;t need to know current state of the state machine.</li>
<li>The state machine itself is the one who creates/removes the timer which triggers timeout event. I am also thinking about moving this out of the state machine and do this in another mixin, only have the callback functions provided by the state machine. But I am not sure.</li>
<li>The state machine has some callback for others(other state machine!) listed below:

<ul>
<li>Enter a state successfully.</li>
<li>Leave a state successfully.</li>
<li>When an event triggers state switch successfully.
In all these callback we would get the previous state and current state, and the event who triggers them.</li>
</ul>
</li>
<li>The CSS class for real UI closing animation is added in <code><em>enterClosing</code> and removed in <code></em>enterClosed</code>. Or else we could do that in <code><em>leaveOpened</code> and <code></em>leaveClosing</code>. I have no strong opinion here.
Maybe we could define the level of the callback into three here, according to the callback order.</li>
<li>The CSS class for real UI opening animation is added in <code><em>enterOpening</code> and removed in <code></em>enterOpened</code>.</li>
<li>We could also move out (4) and (5) to another mixin to purify the state machine.</li>
</ol>


<p>Finally, back to the problems addressed in Tim&#8217;s article:</p>

<ul>
<li>Do we need intermediate state?

<ul>
<li>I don&#8217;t think so, at least for now. If we really need to goto next state when we successfully from state A to state B, we could call <code>_processEvent</code> again in the inner callback of the state machine. This doesn&#8217;t violate the policy that only state machine ifself could decide its next state.</li>
<li>If the intermediate state needs to acquire other type of state &#8211; just fetch the current state of the other state machine. Or, if we need, register an one-time callback if the current state doesn&#8217;t meet our requirement.</li>
</ul>
</li>
<li>How about state conflict between two apps?

<ul>
<li>That won&#8217;t happen if we deal with the state changes correctly and independently in each app&#8217;s scope. I hope so.</li>
</ul>
</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HTML5 Page visibility on Fx OS]]></title>
    <link href="http://alivedise.github.com/blog/2013/07/05/page-visibility-on-firefox-os/"/>
    <updated>2013-07-05T04:23:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2013/07/05/page-visibility-on-firefox-os</id>
    <content type="html"><![CDATA[<p> HTML5  page visibility API  UI &#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">handleVisibilityChange</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">hidden</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Pause UI update</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Begin UI update</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;visibilitychange&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">handleVisibilityChange</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p> API  Firefox OS </p>

<blockquote><p>/ android  onPause/onResume<br/> Low Memory Killer  kill<br/> UI <br/> (onPageShow/onPageHide)  web page/app  UI hierarchy  visibility </p></blockquote>


<p>
<img src="http://i.imgur.com/ypJSsQg.jpg">
Gaia System Architecture Diagram (source from https://docs.google.com/drawings/d/18DnhTgQBK3M0KBeLGJkWW1hfiYBB6GgTmfdbUnT2SLs/edit?usp=sharing)</p>

<p> app </p>

<ol>
<li>Screen off ()</li>
<li>Call screen ()</li>
<li>Lockscreen on ()</li>
<li>Inline activities (app web activities )</li>
<li>App transition end (app )</li>
<li>Back to home ( homescreen)</li>
</ol>


<p>inline activity  inline activities  activity frame  activity frame &#8230;</p>

<p> Gaia Firefox OS  UI  JavaScript  moz-*  API  callback  custom event  system app  Window Manager </p>

<p> Gaia  UI  Gecko  API expose  API  JavaScript/HTML </p>

<p>
 (LockScreen) visibility </p>

<h5>Screen is off by idle timeout:</h5>

<ul>
<li>(Gaia) [Screen Manager] mozPower.screenEnabled = false</li>
<li>(Gaia) [Screen Manager] send custom &#8216;screenchange&#8217; event</li>
<li>(Gaia) [Lockscreen] get &#8216;screenchange&#8217; event, check the settings of &#8220;lockscreen.enabled&#8221; and dispatch custom &#8216;lock&#8217; event</li>
<li>(Gaia) [Window Manager] get &#8216;lock&#8217; event, and then set visibility = false for current app(focused one).</li>
<li>(Gonk) [/sys/power] See mozPower.screenEnabled is modified and send &#8216;sizemodechange&#8217; to simulate the content window is minimized.</li>
<li>(Gecko) [shell] Get &#8216;sizemodechange&#8217; event, set visibility = false for the whole system app</li>
</ul>


<h5>Turn on screen:</h5>

<ul>
<li>(Gecko) Get keypress event of sleep-button, and then send mozChromeEvent to gaia</li>
<li>(Gaia) [Hardware Button Manager] Get mozChromeEvent with type = &#8220;sleep-button-press&#8221;, wrap the event to &#8216;wake&#8217; event</li>
<li>(Gaia) [Screen Manager] mozPower.screenEnabled = true</li>
<li>(Gecko) [shell] Get &#8216;sizemodechange&#8217; event, set visibility = true for the whole system app
[NOTE] the current app is still invisible now, but the system app is visible.</li>
</ul>


<h5>Unlock the lockscreen:</h5>

<ul>
<li>(Gaia) [Lockscreen] Send custom &#8216;unlock&#8217; event.</li>
<li>(Gaia) [Widow Manager] Get &#8216;unlock&#8217; event and turn on the active app&#8217;s visibility.</li>
</ul>


<p> App  visibilitychange event handler  visibility state  website/web application  web-based OS /app/ FirefoxOS app</p>

<p>P.S. This is posted at moztech first. See <a href="http://tech.mozilla.com.tw/posts/2020/visibility-api-on-firefox-os-%E5%BE%9E%E6%87%89%E7%94%A8%E7%A8%8B%E5%BC%8F%E5%89%8D%E8%83%8C%E6%99%AF%E6%8E%A7%E5%88%B6%E7%9C%8B-os-%E5%AF%A6%E4%BD%9C">here</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My first year at Mozilla]]></title>
    <link href="http://alivedise.github.com/blog/2013/07/05/one-year-at-mozilla/"/>
    <updated>2013-07-05T02:31:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2013/07/05/one-year-at-mozilla</id>
    <content type="html"><![CDATA[<h3>Achievements</h3>

<ul>
<li></li>
<li></li>
<li><a href="https://wiki.mozilla.org/Modules/FirefoxOS#System">module peer</a></li>
<li>WebAPI</li>
<li></li>
<li></li>
<li>Firefoxlayout engine: Geckopatch<a href="http://www.mozilla.org/hacking/committer/">Level 1 Committer</a></li>
<li>patchbug</li>
<li>pattern</li>
<li></li>
<li></li>
<li>&#8221;&#8221;</li>
<li>bug<img src="http://i.imgur.com/JPR0wzu.jpg"></li>
<li><a href="http://coscup.org/2012/en/program/">COSCUP 2012talk</a></li>
<li><a href="http://coscup.org/2013/zh-tw/program/">FxOStalk</a></li>
<li><img src="http://i.imgur.com/ffpaudD.jpg"></li>
</ul>


<h3>Canvas</h3>

<h4>MountainView</h4>

<p><img src="http://i.imgur.com/V1mXfJf.jpg">
<img src="http://i.imgur.com/ytFnxpi.jpg">
<img src="http://i.imgur.com/pCGMHcF.jpg"></p>

<h4>San Francisco</h4>

<p><img src="http://i.imgur.com/2WElJM1.jpg">
<img src="http://i.imgur.com/OBv99Ty.jpg">
<img src="http://i.imgur.com/7u3g8IC.jpg"></p>

<h4>Berlin - Snow!</h4>

<p><img src="http://i.imgur.com/cO74ubC.jpg">
<img src="http://i.imgur.com/EULi3MV.jpg">
<img src="http://i.imgur.com/tSer20f.jpg">
<img src="http://i.imgur.com/FEtE2wg.jpg"></p>

<h4>Spain</h4>

<p><img src="http://i.imgur.com/eufuWlp.jpg">
<img src="http://i.imgur.com/tbjIL9m.jpg">
<img src="http://i.imgur.com/GkWfumD.jpg">
<img src="http://i.imgur.com/v8Y3472.jpg"></p>

<h4>Japan</h4>

<ul>
<li> - </li>
<li>Mozilla - 
<img src="http://i.imgur.com/z4ekB4W.jpg">
<img src="http://i.imgur.com/2ErLpTd.jpg">
<img src="http://i.imgur.com/qtQGJuH.jpg">
<img src="http://i.imgur.com/BTRD67c.jpg">
<img src="http://i.imgur.com/q27j5yp.jpg"></li>
</ul>


<h3>While (true) {</h3>

<ul>
<li>javascriptpattern</li>
<li>side probject</li>
<li>bug track listbug</li>
<li>gaia</li>
<li>blog!</li>
<li>

<h3>}</h3></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Recent side projects: Alvitr, Lucifer, GaiaSystemAPIDOC]]></title>
    <link href="http://alivedise.github.com/blog/2013/06/18/alvitr/"/>
    <updated>2013-06-18T12:33:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2013/06/18/alvitr</id>
    <content type="html"><![CDATA[<h3>Alvitr</h3>

<p>Alvitr(</p>

<p>(Puzzle &amp; Dragon)

</p>

<p><a href="http://alivedise.github.io/alvitr">Alvitr</a></p>

<p>Amazon AWS + node.js

1. AWS
2. node.jscrashcjs)</p>

<p>clientjavascript application
IE9Canvas</p>

<h4>Canvas templating</h4>

<p></p>

<p>configurtaionconfiguration</p>

<p><a href="https://github.com/alivedise/alvitr/blob/gh-pages/javascripts/client.js">client.js</a></p>

<p>x, y, weight, height, color</p>

<h3>Lucifer</h3>

<blockquote><p></p></blockquote>


<p><a href="http://alivedise.github.io/lucifer">Lucifer</a></p>

<p>ejs template engine</p>

<h3>Gaia System API Documentation</h3>

<p><a href="http://alivedise.github.io/gaia-system-jsdoc/">Gaia System JSDOC</a>
<a href="https://github.com/alivedise/jsdoc3-bootstrap">JSDOC3 bootstrap template</a>
jsdoc2jsdoc3npm</p>

<p>jsdoc3template&#8230;bootstrap</p>

<h3></h3>

<p>probject&#8230;:P</p>

<p>Mozilla&#8230;.
side project</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascriptscalerotate]]></title>
    <link href="http://alivedise.github.com/blog/2013/05/27/rotation-matrix/"/>
    <updated>2013-05-27T15:41:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2013/05/27/rotation-matrix</id>
    <content type="html"><![CDATA[<p>
<a href="http://css-tricks.com/get-value-of-css-rotation-through-javascript/">http://css-tricks.com/get-value-of-css-rotation-through-javascript/</a></p>

<p>CSS3 transformbug
transformelement</p>

<p>Mutation Observerscale)
transformelement.stylescale
getComputedStyle
skewtranslate</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Construct a mutation observer.</span>
</span><span class='line'><span class="cm">   * See https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * var target = document.querySelector(&#39;#id&#39;);</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#id&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * create an observer instance</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mutations</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * We could iterate the mutations here,</span>
</span><span class='line'><span class="cm">     * but I don&#39;t really care it now.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">st</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">tr</span> <span class="o">=</span> <span class="nx">st</span><span class="p">.</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="s2">&quot;-webkit-transform&quot;</span><span class="p">)</span> <span class="o">||</span>
</span><span class='line'>             <span class="nx">st</span><span class="p">.</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="s2">&quot;-moz-transform&quot;</span><span class="p">)</span> <span class="o">||</span>
</span><span class='line'>             <span class="nx">st</span><span class="p">.</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="s2">&quot;-ms-transform&quot;</span><span class="p">)</span> <span class="o">||</span>
</span><span class='line'>             <span class="nx">st</span><span class="p">.</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="s2">&quot;-o-transform&quot;</span><span class="p">)</span> <span class="o">||</span>
</span><span class='line'>             <span class="nx">st</span><span class="p">.</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Matrix: &#39;</span> <span class="o">+</span> <span class="nx">tr</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// rotation matrix - http://en.wikipedia.org/wiki/Rotation_matrix</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="nx">tr</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>    <span class="nx">values</span> <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>    <span class="nx">values</span> <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">scale</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="o">*</span><span class="nx">b</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// arc sin, convert from radians to degrees, round</span>
</span><span class='line'>    <span class="c1">// DO NOT USE: see update below</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">sin</span> <span class="o">=</span> <span class="nx">b</span><span class="o">/</span><span class="nx">scale</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">angle</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">asin</span><span class="p">(</span><span class="nx">sin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// works!</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Scale: &#39;</span> <span class="o">+</span> <span class="nx">scale</span> <span class="o">+</span> <span class="s1">&#39;;Rotate: &#39;</span> <span class="o">+</span> <span class="nx">angle</span> <span class="o">+</span> <span class="s1">&#39;deg&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">    * Configuration of mutation observer.</span>
</span><span class='line'><span class="cm">    */</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">attributes</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">childList</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">characterData</span><span class="o">:</span> <span class="kc">true</span> <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * pass in the target node, as well as the observer options</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[From browser to browser. (1)]]></title>
    <link href="http://alivedise.github.com/blog/2013/02/23/from-browser-to-browser/"/>
    <updated>2013-02-23T17:40:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2013/02/23/from-browser-to-browser</id>
    <content type="html"><![CDATA[<h3>Firefox OS</h3>

<p><img src="http://cdn0.mos.techradar.futurecdn.net///art/mobile_phones/Mozilla/FireFoxOS/DeveloperHandsets/FirefoxOSDev-Press-01-580-75.jpg"></p>

<h3>System app</h3>

<p>Exactly, Firefox OS, also known for boot 2 gecko, is having only one app/one page.
It&#8217;s the system app, which controls all web app&#8217;s life cycle.
When FirefoxOS is booted, it would load the system app from <code>system/index.html</code>.
Then system app would take care of the remaing stuff.</p>

<ul>
<li>Load modules</li>
<li>Init homescreen app</li>
<li>Etc.</li>
</ul>


<h3>Window Manager</h3>

<p>Window Manager is the core of Firefox OS, the core of system app, which is in charge of creating/maintaining/killing apps.
An app, indeed, is a web page.</p>

<p>We use a magic, calling browser API, to make a web page act like an app.</p>

<h3>Browser API</h3>

<p>See https://developer.mozilla.org/en-US/docs/DOM/Using_the_Browser_API</p>

<p>A browser here means that the web page acts like it is living in a browser <code>frame</code>.
We are replacing nearly every XUL-based UI with HTML to <code>port</code> the WEB to the phone.</p>

<h3>Module Pattern</h3>

<p>Module pattern is the way Window Manager being imeplemented.
A module pattern looks like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">WindowManager</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">_running</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">createApp</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>     <span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">();</span>
</span><span class='line'>     <span class="nx">_running</span><span class="p">[</span><span class="nx">_id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">app</span><span class="p">;</span>
</span><span class='line'>     <span class="nx">_id</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>     <span class="k">return</span> <span class="nx">app</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">killApp</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">delete</span> <span class="nx">_running</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">create</span><span class="o">:</span> <span class="nx">createApp</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">kill</span><span class="o">:</span> <span class="nx">killApp</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Thus the Window Manager object only has 2 public attributes.
This looks fine, but it would be a nightmare if this pattern grows to over 2000 lines.
And it&#8217;s having countless private functions now.</p>

<p>This module now is not unit testable nor maintainable.</p>

<h3>Break it!</h3>

<h4>From the browser to the browser</h4>

<p>Let&#8217;s define a new object to contain and manage itself in its own scope.</p>

<p>It&#8217;s called <code>browserFrame</code>.</p>

<h5>The responsibility of browserFrame</h5>

<p>It would create an iframe with all attributes needed for BrowserAPI.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* Define a basic mozbrowser iframe class.</span>
</span><span class='line'><span class="cm"> * It creates a mozbrowser iframe,</span>
</span><span class='line'><span class="cm"> * and finally returns the DOM element it just created.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">BrowserFrame</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="nx">invocation</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">BrowserFrame</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// This constructor function is a local variable.</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">nextId</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>    <span class="nx">createFrame</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span> <span class="c1">// All arguments are values to createFrame</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">BrowserFrame</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;browser&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// These are helper functions and variables used by the methods above</span>
</span><span class='line'>  <span class="c1">// They&#39;re not part of the public API of the module, but they&#39;re hidden</span>
</span><span class='line'>  <span class="c1">// within this function scope so we don&#39;t have to define them as a</span>
</span><span class='line'>  <span class="c1">// property of Browser or prefix them with underscores.</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">createFrame</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">origin</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">manifestURL</span><span class="p">,</span> <span class="nx">oop</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">browser</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;mozallowfullscreen&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Most apps currently need to be hosted in a special &#39;mozbrowser&#39; iframe.</span>
</span><span class='line'>    <span class="c1">// They also need to be marked as &#39;mozapp&#39; to be recognized as apps by the</span>
</span><span class='line'>    <span class="c1">// platform.</span>
</span><span class='line'>    <span class="nx">browser</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;mozbrowser&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">oop</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">browser</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;remote&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">manifestURL</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">browser</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;mozapp&#39;</span><span class="p">,</span> <span class="nx">manifestURL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">origin</span><span class="p">)</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">origin</span> <span class="o">=</span> <span class="nx">origin</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">browser</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">browser</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">className</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">browser</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">BrowserFrame</span><span class="p">.</span><span class="nx">className</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Store the element</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">browser</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">nextId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// The public API for this module is the Browser() constructor function.</span>
</span><span class='line'>  <span class="c1">// We need to export that function from this private namespace so that</span>
</span><span class='line'>  <span class="c1">// it can be used on the outside. In this case, we export the constructor</span>
</span><span class='line'>  <span class="c1">// by returning it. It becomes the value of the assignment expression</span>
</span><span class='line'>  <span class="c1">// on the first line above.</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">BrowserFrame</span><span class="p">;</span>
</span><span class='line'><span class="p">}());</span> <span class="c1">// Invoke the function immediately after defining it.</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mocha: MockMozActivityglobal leak]]></title>
    <link href="http://alivedise.github.com/blog/2013/02/23/mock-moz-activity/"/>
    <updated>2013-02-23T16:56:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2013/02/23/mock-moz-activity</id>
    <content type="html"><![CDATA[<p>MozActivity</p>

<p>window objectMozActivity</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0) Feed "before all" hook: Error: global leak detected:</span></code></pre></td></tr></table></div></figure>


<p></p>

<p><code>mocha.setup({ignoreLeaks: true});</code></p>

<p><code>mocha.setup({ignoreLeaks: true});</code></p>

<p>MozActivitywindow</p>

<p>module</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="k">new</span> <span class="nx">MozActivity</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="o">:</span> <span class="nx">url</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>browser app</p>

<p>mocha</p>

<ol>
<li>window.MozActivity</li>
<li>MozActivity</li>
</ol>


<p>MockMozActivitywindowMozActivity</p>

<p>MockMozActivityactivity</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">mockMozActivityInstance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">MockMozActivity</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">MozActivity</span><span class="p">(</span><span class="nx">configuration</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">property</span> <span class="k">in</span> <span class="nx">configuration</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">configuration</span><span class="p">[</span><span class="nx">property</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">mockMozActivityInstance</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// Captive Portal Test</span>
</span><span class='line'>  <span class="nx">test</span><span class="p">(</span><span class="s1">&#39;system/captive portal login w/o manual enable wifi&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">CaptivePortal</span><span class="p">.</span><span class="nx">handleEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">MockSettingsListener</span><span class="p">.</span><span class="nx">mCallback</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">mockMozActivityInstance</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s1">&#39;view&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p> \O/</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript memorization]]></title>
    <link href="http://alivedise.github.com/blog/2012/12/22/javascript-memorization/"/>
    <updated>2012-12-22T00:28:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2012/12/22/javascript-memorization</id>
    <content type="html"><![CDATA[<p>As you know, function in javascript is also an object,
you could use a property of the object to keep function result.
This is called <code>Memorization</code>.</p>

<p>Today I have a chance to utilize this skill.</p>

<p>Please read codes below first:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">getOffOrigin</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">url</span> <span class="o">?</span> <span class="nx">app</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">url</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">src</span><span class="p">,</span> <span class="nx">origin</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">subtitle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">subtitle</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">getOffOrigin</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">url</span> <span class="o">?</span> <span class="nx">app</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">url</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">src</span><span class="p">,</span> <span class="nx">origin</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">card</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">subtitle</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>getOffOrigin</code> has to use some logic to compare the two arguments and return a string.
The result wouldn&#8217;t change if the arguments are the same.
Therefore, to avoid calling the function many times, the result could be stored in the function itself.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="kd">function</span> <span class="nx">getOffOrigin</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">origin</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Use src and origin as cache key</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">cacheKey</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">cacheKey</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="kr">native</span> <span class="o">=</span> <span class="nx">getOriginObject</span><span class="p">(</span><span class="nx">origin</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">getOriginObject</span><span class="p">(</span><span class="nx">src</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">==</span> <span class="s1">&#39;http:&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Display http:// protocol anyway</span>
</span><span class='line'>        <span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">cacheKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">+</span> <span class="s1">&#39;//&#39;</span> <span class="o">+</span> <span class="nx">current</span><span class="p">.</span><span class="nx">hostname</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="kr">native</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">==</span> <span class="nx">current</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>          <span class="kr">native</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">==</span> <span class="nx">current</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>          <span class="kr">native</span><span class="p">.</span><span class="nx">port</span> <span class="o">==</span> <span class="nx">current</span><span class="p">.</span><span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Same origin policy</span>
</span><span class='line'>        <span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">cacheKey</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">==</span> <span class="s1">&#39;app:&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Avoid displaying app:// protocol</span>
</span><span class='line'>        <span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">cacheKey</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">cacheKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">+</span> <span class="s1">&#39;//&#39;</span> <span class="o">+</span> <span class="nx">current</span><span class="p">.</span><span class="nx">hostname</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">cacheKey</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>If we only have one arguments we could use it as the key to cache directly.
But we have multiple arguments in this case, we then use stringilized JSON to be the key.</p></li>
<li><p>Hence we don&#8217;t need to do the same thing every time we enter this function if the arguments are used before.</p></li>
<li><p>Have fun with your function cache!</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Web activity]]></title>
    <link href="http://alivedise.github.com/blog/2012/09/04/web-activity/"/>
    <updated>2012-09-04T15:45:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2012/09/04/web-activity</id>
    <content type="html"><![CDATA[<p>Web activityMozillaweb app
Firefox OSPlatform/UIWeb appWeb activity
Gallery</p>

<p></p>

<h3>Request</h3>

<p>E-mail
Activity</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MozActivity</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;browse&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;image/png&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;...&#39;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>typefilter
data</p>

<p></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="nx">a</span><span class="p">.</span><span class="nx">onsuccess</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">on_success</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">image</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="nx">a</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">on_error</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;error when picking!&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Reciever</h3>

<p>ActivityAppManifest.webapp</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s2">&quot;activities&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>   <span class="s2">&quot;pick&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>     <span class="s2">&quot;filters&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>       <span class="nx">type</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;image/png&quot;</span><span class="p">,</span> <span class="s2">&quot;image/gif&quot;</span><span class="p">],</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="s2">&quot;disposition&quot;</span><span class="o">:</span> <span class="s2">&quot;window&quot;</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>javascriptActivity</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">navigator</span><span class="p">.</span><span class="nx">setMozMessageHandler</span><span class="p">(</span><span class="s1">&#39;activity&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">image</span> <span class="o">=</span> <span class="nx">getImageToReturn</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">image</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">a</span><span class="p">.</span><span class="nx">postError</span><span class="p">(</span><span class="s2">&quot;NoImage&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">a</span><span class="p">.</span><span class="nx">postResult</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;image/png&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="o">:</span> <span class="nx">image</span> <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>data/type</h4>

<p>pickActivity
&#8217;email&#8217;
&#8217;&#8217;
UI</p>

<p>data typeactivity</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="c1">// Email app</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MozActivity</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;pick&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;web-content/email&#39;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="c1">// Dialer app</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MozActivity</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;pick&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;web-content/numbers&#39;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">navigator</span><span class="p">.</span><span class="nx">setMozMessageHandler</span><span class="p">(</span><span class="s1">&#39;activity&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">switch</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;webcontacts/numbers&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="c1">// ...</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;webcontacts/email&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="c1">// ...</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>UI</p>

<h3>Reciever?</h3>

<p>
Firefox OSUI
<img src="http://i.imgur.com/V2rgq.jpg">
<img src="http://i.imgur.com/xcgBK.png">
<img src="http://i.imgur.com/UpaOC.png"></p>

<h3></h3>

<p>Web activity
specplatform implementationUI implementation
/</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[gaia] HTML5 Window Shade]]></title>
    <link href="http://alivedise.github.com/blog/2012/07/05/gaia-window-shade/"/>
    <updated>2012-07-05T13:58:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2012/07/05/gaia-window-shade</id>
    <content type="html"><![CDATA[<h1>Window Shade</h1>

<p>Samsung Galaxy S3Android 4.0.4</p>

<p>facebook/google+/&#8230;bar</p>

<p>barUI</p>

<ol>
<li></li>
<li></li>
</ol>


<p><img src="http://i.imgur.com/nU76i.png"></p>

<p>UXGoogle<b>Window shade</b></p>

<p>


</p>

<h1>GAIAnotification panel</h1>

<p>Firefox OSUI - <a href="http://github.com/mozilla-central/gaia">GAIA</a>
</p>

<p>contributorpull request</p>

<p><a href="https://github.com/mozilla-b2g/gaia/pull/1898">Gaia pull request#1898</a>
</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="nx">onTouchMove</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">ut_onTouchMove</span><span class="p">(</span><span class="nx">touch</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">screenHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">height</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">gripBarHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gripBar</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">height</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">startY</span> <span class="o">-</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">pageY</span><span class="p">),</span>
</span><span class='line'>        <span class="nx">newHeight</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">shown</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">dy</span> <span class="o">+=</span> <span class="nx">screenHeight</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">dy</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">screenHeight</span><span class="p">,</span> <span class="nx">dy</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">dy</span> <span class="o">&gt;</span> <span class="nx">gripBarHeight</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">quickSettingsHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">quickSettings</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">height</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">dy</span> <span class="o">&lt;</span> <span class="nx">quickSettingsHeight</span> <span class="o">+</span> <span class="nx">gripBarHeight</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">newHeight</span> <span class="o">=</span> <span class="nx">screenHeight</span> <span class="o">-</span> <span class="nx">quickSettingsHeight</span> <span class="o">-</span> <span class="nx">gripBarHeight</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">newHeight</span> <span class="o">=</span> <span class="nx">screenHeight</span> <span class="o">-</span> <span class="nx">dy</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">quickSettings</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">quickSettings</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span> <span class="s1">&#39;translateY(&#39;</span> <span class="o">+</span> <span class="nx">newHeight</span> <span class="o">+</span> <span class="s1">&#39;px)&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">style</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">style</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span> <span class="s1">&#39;translateY(&#39;</span> <span class="o">+</span> <span class="nx">dy</span> <span class="o">+</span> <span class="s1">&#39;px)&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="c1">//....skiped...</span>
</span><span class='line'>  <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">ut_show</span><span class="p">(</span><span class="nx">dy</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">alreadyShown</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">shown</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">trayStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">style</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">quickSettingsStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">quickSettings</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">trayStyle</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;-moz-transform 0.2s linear&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">trayStyle</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span> <span class="s1">&#39;translateY(100%)&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">quickSettingsStyle</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;-moz-transform 0.2s linear&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">quickSettingsStyle</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span> <span class="s1">&#39;translateY(0px)&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">shown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;utility-tray&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">alreadyShown</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">evt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span><span class="p">(</span><span class="s1">&#39;CustomEvent&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">evt</span><span class="p">.</span><span class="nx">initCustomEvent</span><span class="p">(</span><span class="s1">&#39;utilitytrayshow&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
</span><span class='line'>      <span class="nb">window</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>quick-setting</code>
codemerge</p>

<h1>issue</h1>

<p>function&#8230;.XD</p>

<p>@colinfreicode
</p>

<p>CSS3TransitionWindow Shade</p>

<h2>CSS: Transition</h2>

<p><a href="https://developer.mozilla.org/en/CSS/transition">MDN: transition</a></p>

<h2>CSS: Transform</h2>

<p><a href="https://developer.mozilla.org/en/CSS/transform">MDN: transform</a></p>

<h1></h1>

<ol>
<li><code>utility-tray</code><code>div</code><code>-moz-calc(100% - UTILITY_TRAY_HEIGHT)</code></li>
<li><p>Touch<code>translateY</code></p>

<p> <code>-moz-transform: translateY(px)</code><code>top: px</code>CSS3
 rendering &#8211; <code>-moz-transition: -moz-transform</code>
 </p></li>
<li><p>bar</p>

<ul>
<li><code>MozTransition</code><code>utility-tray-overlay</code></li>
<li><code>MozTransition</code><code>quick-setting</code></li>
</ul>
</li>
</ol>


<p>4.<code>utility-tray</code> + <code>quick-setting</code><code>utility-tray</code></p>

<p>  = <code>quick-setting</code></p>

<h1>the story continues</h1>

<p></p>

<p>bar</p>

<p>pull request</p>

<p><a href="https://github.com/mozilla-b2g/gaia/pull/2181">GAIA pull request#2181</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="k">case</span> <span class="s1">&#39;transitionend&#39;</span><span class="o">:</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">shown</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;utility-tray&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">overlayStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">firstShownStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">firstShowStyle</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">firstShownStyle</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">phase2hide</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">firstShownStyle</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;-moz-transform 0.2s linear&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">firstShownStyle</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span>
</span><span class='line'>          <span class="s1">&#39;translateY(&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">firstShownPosition</span> <span class="o">+</span> <span class="s1">&#39;px)&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">overlayStyle</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;-moz-transform 0.2s linear&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">overlayStyle</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span> <span class="s1">&#39;translateY(0)&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Check the transition event is triggered at firstShown.</span>
</span><span class='line'>        <span class="c1">// If so, turn off the flag which represent for</span>
</span><span class='line'>        <span class="c1">// &#39;The overlay has already reached the bottom of quick-setting&#39;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">firstShown</span><span class="p">)</span>
</span><span class='line'>          <span class="k">this</span><span class="p">.</span><span class="nx">phase2hide</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Reset position of this.firstShown</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">firstShown</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">firstShown</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span> <span class="s1">&#39;translateY(0)&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>transitionend</code> event callback<code>Transition</code></p>

<ol>
<li><code>utility-tray</code>/<code>quick-setting</code></li>
<li><code>utility-tray</code>transition<code>transitionend</code>
 <code>utility-tray</code>transition&#8230;
 <code>quick-setting</code><code>utility-tray</code></li>
</ol>


<h2>transitionend</h2>

<p><a href="https://developer.mozilla.org/zh_tw/CSS_%E8%BD%89%E5%A0%B4#.E5.81.B5.E6.B8.AC_transition_.E7.9A.84.E5.AE.8C.E6.88.90">MDN: transitionend</a></p>

<h1>the end?</h1>

<p>UXpull request
&#8230;I did learn something from these codes:)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[WEB] Web Application Core]]></title>
    <link href="http://alivedise.github.com/blog/2012/06/10/web-application-core/"/>
    <updated>2012-06-10T17:06:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2012/06/10/web-application-core</id>
    <content type="html"><![CDATA[<p><a href="http://addyosmani.github.com/backbone-aura/">Backbone Aura</a>web application core
* widgetlife cycle
* DOM
* publish/subscribe</p>

<p></p>

<h2>widgetlife cycle</h2>

<p>Core(entry poing)initwidget/application partCorewidget</p>

<h2>DOM</h2>

<p>jQuery libraryjQuerylibraryjQueryDOM</p>

<h2>publish/subscribe</h2>

<p>application part/widgetattribute functionpublish/subscribejmvcbackbonebackbone aura</p>

<p>source<code>aura/www/js/aura/mediator.js</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Subscribe to an event</span>
</span><span class='line'><span class="cm"> * @param {string} channel Event name</span>
</span><span class='line'><span class="cm"> * @param {object} subscription Module callback</span>
</span><span class='line'><span class="cm"> * @param {object} context Context in which to execute the module</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="nx">obj</span><span class="p">.</span><span class="nx">subscribe</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">])</span> <span class="o">?</span> <span class="p">[]</span> <span class="o">:</span> <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">];</span>
</span><span class='line'>    <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">method</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">));</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Publish an event, passing arguments to subscribers. Will</span>
</span><span class='line'><span class="cm"> * call start if the channel is not already registered.</span>
</span><span class='line'><span class="cm"> * @param {string} channel Event name</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="nx">obj</span><span class="p">.</span><span class="nx">publish</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">obj</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>widget namecallback functionarray</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[javascript] function hoisting]]></title>
    <link href="http://alivedise.github.com/blog/2012/06/10/function-hoisting-appliance/"/>
    <updated>2012-06-10T16:17:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2012/06/10/function-hoisting-appliance</id>
    <content type="html"><![CDATA[<h1>function hoisting</h1>

<p>jsjsfunction xxx(){}scope
hoisting</p>

<p>Javascript PatternshoistingXD</p>

<p>PTT Web_Design<a href="http://www.ptt.cc/bbs/Ajax/M.1339127132.A.226.html">[] jQuery ~</a>js</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#test&quot;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">aaa</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">aaa</span><span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;yo&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2></h2>

<p>function hoisting</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#test&quot;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">aaa</span><span class="p">);</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">aaa</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;yo&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cm">/* function expression instead of function declaration */</span>
</span></code></pre></td></tr></table></div></figure>


<p>jsfiddle</p>

<iframe style="width: 100%; height: 300px" src="http://jsfiddle.net/Ytmqw/embedded/js,resources,html,css,result/light/"></iframe>


<h1></h1>

<p>po</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[assignmentJSON]]></title>
    <link href="http://alivedise.github.com/blog/2012/05/31/underline-to-json/"/>
    <updated>2012-05-31T10:53:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2012/05/31/underline-to-json</id>
    <content type="html"><![CDATA[<p>Server</p>

<pre><code>user_i0_name=alive
user_i0_gender=male
user_i0_age=27
user_i0_company_c0_name=VIVOTEK
user_i0_company_c1_name=Mozilla
system_model=ABC1234
network_hostname=abc1234
</code></pre>

<p>object
objectassignment</p>

<h1>Step#1: eval</h1>

<p></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">object</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">string_rev_1</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;object[\&#39;&#39;</span><span class="o">+</span><span class="nx">string</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\r\n$/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\r\n/gi</span><span class="p">,</span> <span class="s1">&#39;\r\nobject[\&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/=/gi</span><span class="p">,</span> <span class="s1">&#39;\&#39;]=&#39;</span><span class="p">));</span>
</span><span class='line'><span class="nb">eval</span><span class="p">(</span><span class="nx">string_rev_1</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>object</p>

<h1>Step#2: object</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">string_rev_2</span> <span class="o">=</span> <span class="nx">string_rev_1</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/_/gi</span><span class="p">,</span> <span class="s1">&#39;\&#39;&#39;</span><span class="p">][</span><span class="err">\</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>undefined</p>

<pre><code>user_i0_name=alive
</code></pre>

<p></p>

<pre><code>object['user']['i0']['name']=alive
</code></pre>

<p>eval<code>i10 is undefined.</code>
reference</p>

<p><code>\r\n</code>assignmentevaltry catch
assignment</p>

<p>()</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CanJS]]></title>
    <link href="http://alivedise.github.com/blog/2012/05/30/can-js/"/>
    <updated>2012-05-30T17:33:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2012/05/30/can-js</id>
    <content type="html"><![CDATA[<h1>CanJS</h1>

<p>CanJSJMVCMVCJavascriptMVCBackbone
JMVCMVCcase solutionBackboneMVCJMVCMVC frameworkjQueryBackbonezepto(jQueryjs lib)appbackbonejmvc</p>

<h1>CanJS</h1>

<p><a href="http://canjs.us">CanJS</a>
</p>

<ol>
<li>Zepto, jQuery, YUI, Dojo, Mootools</li>
<li>
<img src="http://bitovi.com/images/introducing-canjs/performance_control.png">
<img src="http://bitovi.com/images/introducing-canjs/performance_livebind.png">
backbonelive binding</li>
<li>ModeljqueryMXmodel instanceCanJSObjectinstance</li>
<li>Viewlive bindingModel change</li>
</ol>


<h1></h1>

<p>JMVCCanJSBackbone</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[WEB]]></title>
    <link href="http://alivedise.github.com/blog/2012/05/30/i-have-also-a-story-to-tell/"/>
    <updated>2012-05-30T04:15:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2012/05/30/i-have-also-a-story-to-tell</id>
    <content type="html"><![CDATA[<p></p>

<p></p>

<p>ptt soft_jobweb_design<a href="http://www.ptt.cc/bbs/Soft_Job/M.1335873183.A.F23.html">http://www.ptt.cc/bbs/Soft_Job/M.1335873183.A.F23.html</a></p>

<p><img src="http://i.imgur.com/CB6eE.jpg"></p>

<h3>0</h3>

<p></p>

<h3>1</h3>

<p>WEB<b></b></p>

<p>jQueryjsjQueryjavascript</p>

<p>web application</p>

<h3>2</h3>

<p><img src="http://i.imgur.com/CMRWv.jpg"></p>

<p>IPADappzitematerialsourcecss hackcsstagtoggleipad</p>

<p></p>

<h3>3</h3>

<p><img src="http://i.imgur.com/R7n2P.png"></p>

<p>google</p>

<p>webweb developer<b></b>
</p>

<p>Y!Josephj(F2E)</p>

<p>TonyQ</p>

<p>open source</p>

<p><a href="http://coolshell.cn"></a>Amazon
Web<a href="http://coolshell.cn/articles/1932.html"></a>javascript<b></b>
<a href="http://coolshell.cn/articles/6346.html"></a><a href="http://coolshell.cn/articles/7186.html"></a><a href="http://coolshell.cn/articles/6142.html"></a></p>

<p>githubgithubNASwordpressXDiteoctopressgithubgithub pages</p>

<p></p>

<h3>4</h3>

<p><img src="http://i.imgur.com/V8dg6.jpg" title="" ></p>

<p></p>

<p>X12123,4,5,6,7,8x</p>

<p></p>

<p></p>

<p>WEBWeb ApplicationUIOSDClighting talk<b></b>Interface Designer(//CSS)</p>

<p></p>

<p>QAUI specfunctional specspec11~1XspecwordWEBspecuiUI bug</p>

<p>MVCweb applicationQAspecspec</p>

<h3>5</h3>

<p><img src="http://i.imgur.com/6FkRe.jpg"></p>

<p>JavascriptMVCtotal solution client side MVC frameworkBackbone.jsbackbonebackbone? backbone</p>

<p></p>

<p>backbonejmvcYUI, extJS, zkextJSdivSynologyNAS</p>

<h3>6</h3>

<p>JMVCbackboneforum:D</p>

<p>jmvc docrefactorcode</p>

<p><b></b>support</p>

<p></p>

<h3>7</h3>

<ul>
<li></li>
<li></li>
<li><p><code>rhino debuggerMakefiledir-based namespace patternresize event delegationIE8jsdbusdata modelActiveX callbackcss sprite</code>UI</p>

<p>  
  
  </p></li>
</ul>


<h3>8</h3>

<p>deadline  release104</p>

<h3>9</h3>

<p>webMozillaFrontendsupriseMozillaF2E NewbiecoworkjQueryJohn ResigMozilla</p>

<p>Mozilla<u></u></p>

<p></p>

<p></p>

<br/>


<p></p>

<p>Alive Kuo@20120530</p>

<h1>Q&amp;A</h1>

<ol>
<li>4</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JavascriptMVC on Slideshare]]></title>
    <link href="http://alivedise.github.com/blog/2012/05/24/javascriptmvc-slideshare/"/>
    <updated>2012-05-24T14:58:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2012/05/24/javascriptmvc-slideshare</id>
    <content type="html"><![CDATA[<p>Backbone&#8211;JSDC<a href="https://speakerdeck.com/u/jaceju/p/refactoring-with-backbonejs">Refactor with Backbone.js</a>slideshare<a href="http://www.slideshare.net/molily/javascript-application-architecture-with-backbonejs">Javasciprt Application Architecture with Backbone.js</a>JavascriptMVCSlideshare</p>

<p>SlideshareJavascriptMVC</p>

<ol>
<li><a href="http://www.slideshare.net/4lb0/javascriptmvc">JavascriptMVC</a>:</li>
</ol>


<div style="width:425px" id="__ss_10174435"> <strong style="display:block;margin:12px 0 4px"><a href="http://www.slideshare.net/4lb0/javascriptmvc" title="JavascriptMVC" target="_blank">JavascriptMVC</a></strong> <iframe src="http://www.slideshare.net/slideshow/embed_code/10174435" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen></iframe></div>


<ol>
<li><a href="http://www.slideshare.net/zukunftsalick/introduction-to-javascriptmvc">Introduction to JavascriptMVC</a>:</li>
</ol>


<div style="width:425px" id="__ss_7966052"> <strong style="display:block;margin:12px 0 4px"><a href="http://www.slideshare.net/zukunftsalick/introduction-to-javascriptmvc" title="Introduction to JavaScriptMVC" target="_blank">Introduction to JavaScriptMVC</a></strong> <iframe src="http://www.slideshare.net/slideshow/embed_code/7966052" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen></iframe></div>


<ol>
<li><a href="http://www.slideshare.net/tdreyno/jqconf">Organizing Code with JavascriptMVC</a>:</li>
</ol>


<div style="width:425px" id="__ss_5467723"> <strong style="display:block;margin:12px 0 4px"><a href="http://www.slideshare.net/tdreyno/jqconf" title="Organizing Code with JavascriptMVC" target="_blank">Organizing Code with JavascriptMVC</a></strong> <iframe src="http://www.slideshare.net/slideshow/embed_code/5467723" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen></iframe></div>


<p>Backbone&#8230;</p>

<p>Javascript</p>

<div style="width:425px" id="__ss_13010920"> <strong style="display:block;margin:12px 0 4px"><a href="http://www.slideshare.net/DavidSkyAlive/javascriptmvc-another-choice-of-web-framework" title="JavascriptMVC: Another choice of web framework" target="_blank">JavascriptMVC: Another choice of web framework</a></strong> <iframe src="http://www.slideshare.net/slideshow/embed_code/13010920" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen></iframe> <div style="padding:5px 0 12px"> View more <a href="http://www.slideshare.net/" target="_blank">presentations</a> from <a href="http://www.slideshare.net/DavidSkyAlive" target="_blank">Alive Kuo</a> </div> </div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JSDC Taiwan 2012 - ]]></title>
    <link href="http://alivedise.github.com/blog/2012/05/24/jsdc-tw-2012/"/>
    <updated>2012-05-24T14:47:00+08:00</updated>
    <id>http://alivedise.github.com/blog/2012/05/24/jsdc-tw-2012</id>
    <content type="html"><![CDATA[<p><img src="http://i.imgur.com/2YabH.jpg"></p>

<p>5/19()Javascript</p>

<h1>[Key note] Node.JS on Windows Azure</h1>

<p><img src="http://i.imgur.com/FWnFz.jpg"></p>

<p>ericskWindows AzureNode.js</p>

<p>windowsIPADirc clientericskOSDCXD</p>

<h1>[Key note] Gaia: A modern smartphone user interface in HTML5 and JavaScript</h1>

<p><img src="http://i.imgur.com/ivh8j.jpg"></p>

<p>Mozilla&#8230;XDD</p>

<p>IRC</p>

<p>MobileAndroidiOSHTML5MozillaB2GHTML5 appMobile</p>

<p></p>

<h1>Happy Programming with CoffeeScript</h1>

<p><img src="http://i.imgur.com/uLEL9.jpg"></p>

<p>CoffeeScript</p>

<p>CoffeeScript2009commit5+CS&#8230;.</p>

<p>CoffeeScriptcodeJavaScriptCoffeeScript</p>

<h1>JavaScript MVC compare</h1>

<p><img src="http://i.imgur.com/TyoNN.jpg"></p>

<p>TonyQWeb MVC framework</p>

<p>solution</p>

<p>ViewJavascriptMVC-EmbeddedJS</p>

<h1>Module Pattern, AMD, RequireJS</h1>

<p><img src="http://i.imgur.com/Z20kJ.jpg"></p>

<p>RequireJSStealJSlibrary dependancyJS</p>

<p>AMDOrz&#8230;Asynchronous Module Definition</p>

<p>Module PatternJSprivate</p>

<h1>HTML5</h1>

<p>&#8230;.</p>

<h1>RedTea Web Framework</h1>

<p><img src="http://i.imgur.com/2M3uR.jpg"></p>

<p>Non MVC framework</p>

<p>Node.jsframeworkRedTea</p>

<p>framework</p>

<h1> JS  WebAPI</h1>

<p><img src="http://i.imgur.com/IDgs8.jpg"></p>

<p>Mozilla B2Gexport API</p>

<h1>Refactoring with Backbone.js</h1>

<p><img src="http://i.imgur.com/bATCl.jpg"></p>

<p>Backbonerefactor</p>

<h1>Lightning talks</h1>

<h2>JavaScript</h2>

<p><img src="http://i.imgur.com/mblUI.jpg"></p>

<p>WAT!</p>

<p>js</p>

<h2></h2>

<p>jQuery Modile Slider</p>

<h2> d3.js </h2>

<p>Diablo3&#8230;</p>

<h2> JavaScript /</h2>

<p>JS</p>

<h2>Spatial Publish Subscribe for LBS Applications</h2>

<p>&#8230;</p>

<h2> Backbone </h2>

<p>backbone</p>

<h1></h1>

<ul>
<li>BackboneJavascriptMVC</li>
<li>Node.js</li>
<li>Mobile</li>
<li></li>
<li>90%&#8230;</li>
<li></li>
</ul>


<p><img src="http://i.imgur.com/e0pcO.jpg"></p>
]]></content>
  </entry>
  
</feed>
