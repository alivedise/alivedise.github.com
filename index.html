
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Ascheriit</title>
	<meta name="author" content="Alive Kuo">

	
	<meta name="description" content="之前在寫單元測試時，需要測到MozActivity的呼叫。 當我們嘗試去取代window object中的MozActivity時，會遇到： 1
0) Feed "before all" hook: Error: global leak detected: 解決方法： 在程式前面加上mocha. &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Ascheriit" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">Ascheriit</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:alivedise.github.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/alivedise" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/alivedise" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:alivedise.github.com">
	</form>
</nav>

</header>
	
		
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/alivedise">alivedise</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('alivedise', 4, false);
	})(jQuery);
</script>

	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/02/23/mock-moz-activity/">
		
			Mocha: MockMozActivity與global Leak</a>
	</h2>
	<div class="entry-content">
		<p>之前在寫單元測試時，需要測到MozActivity的呼叫。</p>

<p>當我們嘗試去取代window object中的MozActivity時，會遇到：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0) Feed "before all" hook: Error: global leak detected:</span></code></pre></td></tr></table></div></figure>


<p>解決方法：</p>

<p>在程式前面加上<code>mocha.setup({ignoreLeaks: true});</code></p>

<p>最後加上<code>mocha.setup({ignoreLeaks: true});</code></p>

<p>碰到這個錯誤是在嘗試加入假的MozActivity給window時。</p>

<p>因為要被測試的module中有如下的程式片段：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="k">new</span> <span class="nx">MozActivity</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="o">:</span> <span class="nx">url</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>去呼叫browser app開啟某個特定網頁，</p>

<p>但是mocha跑的環境中有可能：</p>

<ol>
<li>並沒有window.MozActivity這個物件。</li>
<li>有MozActivity但是我們無法知道他是否被呼叫。</li>
</ol>


<p>這時候需要塞一個MockMozActivity給window，暫時取代掉原本的MozActivity，</p>

<p>然後從MockMozActivity裡面留個變數記錄被呼叫的參數狀況來判斷程式是否正確的執行呼叫activity。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">mockMozActivityInstance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">MockMozActivity</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">MozActivity</span><span class="p">(</span><span class="nx">configuration</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">property</span> <span class="k">in</span> <span class="nx">configuration</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">configuration</span><span class="p">[</span><span class="nx">property</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">mockMozActivityInstance</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>之後寫的測試內容：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// Captive Portal Test</span>
</span><span class='line'>  <span class="nx">test</span><span class="p">(</span><span class="s1">&#39;system/captive portal login w/o manual enable wifi&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">CaptivePortal</span><span class="p">.</span><span class="nx">handleEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">MockSettingsListener</span><span class="p">.</span><span class="nx">mCallback</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">mockMozActivityInstance</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s1">&#39;view&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>人生第一個單元測試程式完成 \O/</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-02-23T16:56:00+08:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/javascript/'>javascript</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/12/22/javascript-memorization/">
		
			Javascript Memorization</a>
	</h2>
	<div class="entry-content">
		<p>As you know, function in javascript is also an object,
you could use a property of the object to keep function result.
This is called <code>Memorization</code>.</p>

<p>Today I have a chance to utilize this skill.</p>

<p>Please read codes below first:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">getOffOrigin</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">url</span> <span class="o">?</span> <span class="nx">app</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">url</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">src</span><span class="p">,</span> <span class="nx">origin</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">subtitle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">subtitle</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">getOffOrigin</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">url</span> <span class="o">?</span> <span class="nx">app</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">url</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">src</span><span class="p">,</span> <span class="nx">origin</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">card</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">subtitle</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>getOffOrigin</code> has to use some logic to compare the two arguments and return a string.
The result wouldn&#8217;t change if the arguments are the same.
Therefore, to avoid calling the function many times, the result could be stored in the function itself.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="kd">function</span> <span class="nx">getOffOrigin</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">origin</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Use src and origin as cache key</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">cacheKey</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">cacheKey</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="kr">native</span> <span class="o">=</span> <span class="nx">getOriginObject</span><span class="p">(</span><span class="nx">origin</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">getOriginObject</span><span class="p">(</span><span class="nx">src</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">==</span> <span class="s1">&#39;http:&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Display http:// protocol anyway</span>
</span><span class='line'>        <span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">cacheKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">+</span> <span class="s1">&#39;//&#39;</span> <span class="o">+</span> <span class="nx">current</span><span class="p">.</span><span class="nx">hostname</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="kr">native</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">==</span> <span class="nx">current</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>          <span class="kr">native</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">==</span> <span class="nx">current</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>          <span class="kr">native</span><span class="p">.</span><span class="nx">port</span> <span class="o">==</span> <span class="nx">current</span><span class="p">.</span><span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Same origin policy</span>
</span><span class='line'>        <span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">cacheKey</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">==</span> <span class="s1">&#39;app:&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Avoid displaying app:// protocol</span>
</span><span class='line'>        <span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">cacheKey</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">cacheKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">+</span> <span class="s1">&#39;//&#39;</span> <span class="o">+</span> <span class="nx">current</span><span class="p">.</span><span class="nx">hostname</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">cacheKey</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">getOffOrigin</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>If we only have one arguments we could use it as the key to cache directly.
But we have multiple arguments in this case, we then use stringilized JSON to be the key.</p></li>
<li><p>Hence we don&#8217;t need to do the same thing every time we enter this function if the arguments are used before.</p></li>
<li><p>Have fun with your function cache!</p></li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-22T00:28:00+08:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/javascript/'>javascript</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/09/04/web-activity/">
		
			Web Activity</a>
	</h2>
	<div class="entry-content">
		<p>Web activity是由Mozilla設計並開發，用來使web app之間共享資源的框架。
在Firefox OS中已經存在Platform/UI上的實作，並且有一些內建的主要Web app已經利用Web activity來達成跨應用程式溝通的目的。
（如：Gallery使用它來讓其他程式從它挑選圖片，也用同一技術來實現圖片分享到不同應用）</p>

<p>以下介紹如何使用這個新穎的技術。</p>

<h3>Request</h3>

<p>假設今天E-mail應用程式需要從圖片集中挑選圖片來寄送，
那麼它必須新增一個Activity物件如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MozActivity</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;browse&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;image/png&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;...&#39;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>type欄位是用來當filter用的
在data中的其他欄位可以傳你想要的資料給接收方。</p>

<p>當收到資料後，處理回呼函數的方式：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="nx">a</span><span class="p">.</span><span class="nx">onsuccess</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">on_success</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">image</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="nx">a</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">on_error</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;error when picking!&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Reciever</h3>

<p>接受某個Activity的App必須在Manifest.webapp中宣告：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s2">&quot;activities&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>   <span class="s2">&quot;pick&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>     <span class="s2">&quot;filters&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>       <span class="nx">type</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;image/png&quot;</span><span class="p">,</span> <span class="s2">&quot;image/gif&quot;</span><span class="p">],</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="s2">&quot;disposition&quot;</span><span class="o">:</span> <span class="s2">&quot;window&quot;</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>並且在自己的javascript檔中寫好當Activity產生時的處理函式</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">navigator</span><span class="p">.</span><span class="nx">setMozMessageHandler</span><span class="p">(</span><span class="s1">&#39;activity&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">image</span> <span class="o">=</span> <span class="nx">getImageToReturn</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">image</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">a</span><span class="p">.</span><span class="nx">postError</span><span class="p">(</span><span class="s2">&quot;NoImage&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">a</span><span class="p">.</span><span class="nx">postResult</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;image/png&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="o">:</span> <span class="nx">image</span> <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>data/type的用法</h4>

<p>如聯絡人程式可以接受同一個叫做pick的Activity，
但是電子郵件程式需要的是&#8217;email&#8217;這類資料，
而電話程式需要的是&#8217;號碼&#8217;這類資料，
對於這兩類資料需要呈現的UI與最後傳回去的資料當然會是不一樣的。</p>

<p>解決方法就是利用不同的data type來區分同種activity的不同需求：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="c1">// Email app</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MozActivity</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;pick&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;web-content/email&#39;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="c1">// Dialer app</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MozActivity</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;pick&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;web-content/numbers&#39;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>在聯絡人程式中</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">navigator</span><span class="p">.</span><span class="nx">setMozMessageHandler</span><span class="p">(</span><span class="s1">&#39;activity&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">switch</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;webcontacts/numbers&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="c1">// ...</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;webcontacts/email&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="c1">// ...</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>如此一來就可以分開處理UI變化及後續回傳資料的部分。</p>

<h3>多於一個可以處理的Reciever?</h3>

<p>比如圖片應用程式可以分享的對象有兩個以上的時候，
Firefox OS的系統UI便會自動列出可用的應用程式清單，如圖：
<img src="http://i.imgur.com/V2rgq.jpg">
<img src="http://i.imgur.com/xcgBK.png">
<img src="http://i.imgur.com/UpaOC.png"></p>

<h3>結論</h3>

<p>Web activity是一個實驗中的新功能，雖然還有一些地方未盡完善，
但是看著它從spec到platform implementation到UI implementation，
就好像親身參與了網路/網頁進化的過程一樣。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-09-04T15:45:00+08:00" pubdate data-updated="true">Sep 4<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/mozilla-javascript-html5/'>mozilla,javascript,html5</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/07/05/gaia-window-shade/">
		
			[Gaia] HTML5 Window Shade</a>
	</h2>
	<div class="entry-content">
		<h1>Window Shade</h1>

<p>我手上的Samsung Galaxy S3的作業系統是Android 4.0.4。</p>

<p>當我收到facebook/google+/&#8230;等程式通知的時候，最上面那條bar會出現對應的圖示。</p>

<p>這時候可以透過將bar「滑下來」的動作拉出一個UI，裡面會有</p>

<ol>
<li>快速設定</li>
<li>通知項目詳細列表</li>
</ol>


<p><img src="http://i.imgur.com/nU76i.png"></p>

<p>這個UX，Google把它稱為<b>Window shade</b></p>

<p>神奇的地方在於當你在拉下或拉上面板的同時，
快速設定與通知項目是會先「掉下來」到底端，
到了項目的頂端出現之後才會黏在頂部。
（相信我你沒有特別注意這件事情，而且用久了會覺得理所當然）</p>

<h1>GAIA也有notification panel</h1>

<p>Firefox OS的UI - <a href="http://github.com/mozilla-central/gaia">GAIA</a>裡面也有定義功能列以及通知面板這件事，
這個功能正在開發中。</p>

<p>有一天我們收到某個contributor提交的pull request：</p>

<p><a href="https://github.com/mozilla-b2g/gaia/pull/1898">Gaia pull request#1898</a>
節錄重要的修改如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="nx">onTouchMove</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">ut_onTouchMove</span><span class="p">(</span><span class="nx">touch</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">screenHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">height</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">gripBarHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">gripBar</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">height</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">startY</span> <span class="o">-</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">pageY</span><span class="p">),</span>
</span><span class='line'>        <span class="nx">newHeight</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">shown</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">dy</span> <span class="o">+=</span> <span class="nx">screenHeight</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">dy</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">screenHeight</span><span class="p">,</span> <span class="nx">dy</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">dy</span> <span class="o">&gt;</span> <span class="nx">gripBarHeight</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">quickSettingsHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">quickSettings</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">height</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">dy</span> <span class="o">&lt;</span> <span class="nx">quickSettingsHeight</span> <span class="o">+</span> <span class="nx">gripBarHeight</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">newHeight</span> <span class="o">=</span> <span class="nx">screenHeight</span> <span class="o">-</span> <span class="nx">quickSettingsHeight</span> <span class="o">-</span> <span class="nx">gripBarHeight</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">newHeight</span> <span class="o">=</span> <span class="nx">screenHeight</span> <span class="o">-</span> <span class="nx">dy</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">quickSettings</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">quickSettings</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span> <span class="s1">&#39;translateY(&#39;</span> <span class="o">+</span> <span class="nx">newHeight</span> <span class="o">+</span> <span class="s1">&#39;px)&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">style</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">style</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span> <span class="s1">&#39;translateY(&#39;</span> <span class="o">+</span> <span class="nx">dy</span> <span class="o">+</span> <span class="s1">&#39;px)&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="c1">//....skiped...</span>
</span><span class='line'>  <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">ut_show</span><span class="p">(</span><span class="nx">dy</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">alreadyShown</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">shown</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">trayStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">style</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">quickSettingsStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">quickSettings</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">trayStyle</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;-moz-transform 0.2s linear&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">trayStyle</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span> <span class="s1">&#39;translateY(100%)&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">quickSettingsStyle</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;-moz-transform 0.2s linear&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">quickSettingsStyle</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span> <span class="s1">&#39;translateY(0px)&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">shown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;utility-tray&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">alreadyShown</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">evt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span><span class="p">(</span><span class="s1">&#39;CustomEvent&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">evt</span><span class="p">.</span><span class="nx">initCustomEvent</span><span class="p">(</span><span class="s1">&#39;utilitytrayshow&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
</span><span class='line'>      <span class="nb">window</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>原作者提到他做這件事是要讓<code>quick-setting</code>更快的出現。
這段code也已經被merge了。</p>

<h1>不過就在昨天同事發現了一個關於功能列的issue</h1>

<p>於是我開始看發生了什麼事。然後上面那兩個function耗費了我一個下午&#8230;.XD</p>

<p>@colinfrei其實做了一件非常有趣但是很難從code裡面看出端倪的事情。
甚至也很難用語言來描述，不過我想試著說明發生了什麼事，怎麼做到的。</p>

<p>簡單的說，他利用兩個「不同」區塊的CSS3的Transition「同步化」來實現剛剛所提的Window Shade的行為。</p>

<h2>CSS: Transition</h2>

<p><a href="https://developer.mozilla.org/en/CSS/transition">參閱MDN: transition</a></p>

<h2>CSS: Transform</h2>

<p><a href="https://developer.mozilla.org/en/CSS/transform">參閱MDN: transform</a></p>

<h1>真相其實是：</h1>

<ol>
<li><code>utility-tray</code>是一個絕對定位的<code>div</code>，平常位置定在螢幕上方<code>-moz-calc(100% - UTILITY_TRAY_HEIGHT)</code>。</li>
<li><p>當你開始Touch的時候，根據你的移動距離計算<code>translateY</code>，使它產生位移</p>

<p> 你可以把<code>-moz-transform: translateY(px)</code>當成是<code>top: px</code>在CSS3的新招。
 它提供了更快速的rendering &#8211; 當你想利用<code>-moz-transition: -moz-transform</code>來做位移動畫的時候。
 這件事情可以另外寫一篇文章來說（挖洞的意味）。</p></li>
<li><p>當你放開拉bar的時候而且如果已經超過「要讓通知面板掉下來的合法距離」：</p>

<ul>
<li>設定一個<code>MozTransition</code>給<code>utility-tray-overlay</code></li>
<li>再設定一個<code>MozTransition</code>給<code>quick-setting</code></li>
</ul>
</li>
</ol>


<p>4.讓<code>utility-tray</code>整個以某個定速掉下來到螢幕底端 + 讓<code>quick-setting</code>以同樣的定速往上移動到<code>utility-tray</code>的開端</p>

<p>  = 於是就造成了<code>quick-setting</code>似乎黏在通知列下方不動但整個面板是往下掉的假象！</p>

<h1>the story continues</h1>

<p>不過可惜的是似乎沒有考慮到當通知面板要滑上去的時候，</p>

<p>「有物件的部份也應該留在頂端直到被拉bar撞到一起彈上去」這件事</p>

<p>於是我也仿造這個作法另外送了一個pull request</p>

<p><a href="https://github.com/mozilla-b2g/gaia/pull/2181">GAIA pull request#2181</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="k">case</span> <span class="s1">&#39;transitionend&#39;</span><span class="o">:</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">shown</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;utility-tray&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">overlayStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">firstShownStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">firstShowStyle</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">firstShownStyle</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">phase2hide</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">firstShownStyle</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;-moz-transform 0.2s linear&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">firstShownStyle</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span>
</span><span class='line'>          <span class="s1">&#39;translateY(&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">firstShownPosition</span> <span class="o">+</span> <span class="s1">&#39;px)&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">overlayStyle</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;-moz-transform 0.2s linear&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">overlayStyle</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span> <span class="s1">&#39;translateY(0)&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Check the transition event is triggered at firstShown.</span>
</span><span class='line'>        <span class="c1">// If so, turn off the flag which represent for</span>
</span><span class='line'>        <span class="c1">// &#39;The overlay has already reached the bottom of quick-setting&#39;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">firstShown</span><span class="p">)</span>
</span><span class='line'>          <span class="k">this</span><span class="p">.</span><span class="nx">phase2hide</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Reset position of this.firstShown</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">firstShown</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">MozTransition</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">firstShown</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">MozTransform</span> <span class="o">=</span> <span class="s1">&#39;translateY(0)&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>利用<code>transitionend</code> event callback，透過連續兩次的<code>Transition</code>來：</p>

<ol>
<li>讓<code>utility-tray</code>先定速往上移動/讓<code>quick-setting</code>定速往下移動到底端。</li>
<li>等到<code>utility-tray</code>的transition結束時，會收到<code>transitionend</code>的事件。
 這時候再讓<code>utility-tray</code>進行第二次transition&#8230;而目的地就是螢幕頂端。
 同時<code>quick-setting</code>就不再動作了，讓它跟著<code>utility-tray</code>一起被往上卷走。</li>
</ol>


<h2>transitionend</h2>

<p><a href="https://developer.mozilla.org/zh_tw/CSS_%E8%BD%89%E5%A0%B4#.E5.81.B5.E6.B8.AC_transition_.E7.9A.84.E5.AE.8C.E6.88.90">參閱MDN: transitionend</a></p>

<h1>the end?</h1>

<p>其實UX還沒有定義這個行為，所以pull request本身沒有被接受。
不過&#8230;I did learn something from these codes:)</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-07-05T13:58:00+08:00" pubdate data-updated="true">Jul 5<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/b2g/'>b2g</a>, <a class='category' href='/blog/categories/css3/'>css3</a>, <a class='category' href='/blog/categories/firefoxos/'>firefoxos</a>, <a class='category' href='/blog/categories/gaia/'>gaia</a>, <a class='category' href='/blog/categories/html5/'>html5</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/06/10/web-application-core/">
		
			[WEB] Web Application Core</a>
	</h2>
	<div class="entry-content">
		<p>最近看到這篇文章<a href="http://addyosmani.github.com/backbone-aura/">Backbone Aura</a>難得的有提到一個web application core該做些什麼事情？跟我想的蠻相似的，這邊將他列出來：
* 管理widget的life cycle的能力。
* 低階DOM操作處理
* 提供publish/subscribe的溝通管道給應用程式的各部位互相溝通</p>

<p>以下是我流解析。</p>

<h2>管理widget的life cycle</h2>

<p>Core是應用程式的進入點(entry poing)，它必須在適當的時機init需要的widget/application part起來做事情，也只有Core才知道什麼時候必須做這些事情。當然也包括在適當的時機讓widget沈睡或消滅。</p>

<h2>低階DOM操作</h2>

<p>這有點像jQuery library主要在做的事情，不過世界上不是只有jQuery一種library，也不是任何情況下都可以用jQuery，有一個可以快速操作DOM的方法是必要的。</p>

<h2>提供publish/subscribe的溝通方式</h2>

<p>解耦後的application part/widget當然不能直接呼叫別人的attribute function（不然還解什麼耦），那要怎麼叫別人做事？行之有年的publish/subscribe機制在jmvc已經被整合進去，backbone上面還欠缺方法，backbone aura把這件事做出來了。</p>

<p>然後因為好奇它怎麼做的就看了一下source，在<code>aura/www/js/aura/mediator.js</code>裡面定義了：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Subscribe to an event</span>
</span><span class='line'><span class="cm"> * @param {string} channel Event name</span>
</span><span class='line'><span class="cm"> * @param {object} subscription Module callback</span>
</span><span class='line'><span class="cm"> * @param {object} context Context in which to execute the module</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="nx">obj</span><span class="p">.</span><span class="nx">subscribe</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">])</span> <span class="o">?</span> <span class="p">[]</span> <span class="o">:</span> <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">];</span>
</span><span class='line'>    <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">method</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">));</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Publish an event, passing arguments to subscribers. Will</span>
</span><span class='line'><span class="cm"> * call start if the channel is not already registered.</span>
</span><span class='line'><span class="cm"> * @param {string} channel Event name</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="nx">obj</span><span class="p">.</span><span class="nx">publish</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">obj</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">channels</span><span class="p">[</span><span class="nx">channel</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>看起來是利用一個變數來根據widget name儲存callback function進array裡面。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-06-10T17:06:00+08:00" pubdate data-updated="true">Jun 10<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/javascript/'>javascript</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/06/10/function-hoisting-appliance/">
		
			[Javascript] Function Hoisting應用</a>
	</h2>
	<div class="entry-content">
		<h1>function hoisting是什麼？</h1>

<p>一個不說你也不會知道的js語言特性，是指js看到function xxx(){}這種宣告時會把定義搬到scope最頂端
的行為，hoisting的意思是提昇。</p>

<p>自從在Javascript Patterns這本書上面看到hoisting的時候，就一直在想到底有什麼場合可以用到這個奇妙的語言特性？想不到還真的遇到了，雖然其實是個反例XD</p>

<p>原文出自PTT Web_Design版「<a href="http://www.ptt.cc/bbs/Ajax/M.1339127132.A.226.html">[問題] jQuery 參數的問題~</a>」，這名網友問為什麼下面的js不能用？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#test&quot;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">aaa</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">aaa</span><span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;yo&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>好傻好天真？</h2>

<p>雖然不知道為什麼提問者堅持要把函數宣告放在用它之前，不過既然他問了，剛好這情況可以利用function hoisting來做，只是要修改一些小地方。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#test&quot;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">aaa</span><span class="p">);</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">aaa</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;yo&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cm">/* function expression instead of function declaration */</span>
</span></code></pre></td></tr></table></div></figure>


<p>我另外寫了一個jsfiddle來測試：</p>

<iframe style="width: 100%; height: 300px" src="http://jsfiddle.net/Ytmqw/embedded/js,resources,html,css,result/light/"></iframe>


<h1>做的到，只不過真的有必要嗎？</h1>

<p>真的有太多理由不建議這樣做。原po在我回文後也沒出現，看來也無從得知他這樣做的理由了。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-06-10T16:17:00+08:00" pubdate data-updated="true">Jun 10<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/javascript/'>javascript</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/05/31/underline-to-json/">
		
			把assignment變數轉成JSON格式</a>
	</h2>
	<div class="entry-content">
		<p>從Server端收到的資訊是如下格式</p>

<pre><code>user_i0_name=alive
user_i0_gender=male
user_i0_age=27
user_i0_company_c0_name=VIVOTEK
user_i0_company_c1_name=Mozilla
system_model=ABC1234
network_hostname=abc1234
</code></pre>

<p>但是這些資訊很難使用，想透過某個統一的方法把它轉成object來用。
另外存回去的時候要把object轉回跟上面一樣的assignment。</p>

<h1>Step#1: eval拆解進區域變數</h1>

<p>為了避免污染全域變數，前後取代原本的字串：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">object</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">string_rev_1</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;object[\&#39;&#39;</span><span class="o">+</span><span class="nx">string</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\r\n$/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\r\n/gi</span><span class="p">,</span> <span class="s1">&#39;\r\nobject[\&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/=/gi</span><span class="p">,</span> <span class="s1">&#39;\&#39;]=&#39;</span><span class="p">));</span>
</span><span class='line'><span class="nb">eval</span><span class="p">(</span><span class="nx">string_rev_1</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>現在得到了一個只有一層的object，是好用了一點，但是能不能切出多層來？</p>

<h1>Step#2: 用底線切object</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">string_rev_2</span> <span class="o">=</span> <span class="nx">string_rev_1</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/_/gi</span><span class="p">,</span> <span class="s1">&#39;\&#39;&#39;</span><span class="p">][</span><span class="err">\</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>但是這樣會有undefined的問題，如</p>

<pre><code>user_i0_name=alive
</code></pre>

<p>會變成</p>

<pre><code>object['user']['i0']['name']=alive
</code></pre>

<p>eval後會出現<code>i10 is undefined.</code>
所以要想辦法解決這種超前reference的狀況。</p>

<p>一個辦法是用<code>\r\n</code>切分assignment後個別eval，再用try catch區塊判斷是否發生超前定義的情況。
假設發生了就個別處理該assignment。</p>

<p>(待續)</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-05-31T10:53:00+08:00" pubdate data-updated="true">May 31<span>st</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/javascript/'>javascript</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/05/30/can-js/">
		
			CanJS簡介</a>
	</h2>
	<div class="entry-content">
		<h1>CanJS是什麼？</h1>

<p>CanJS是JMVC團隊把MVC這一塊獨立出來的結果，並且做了一些改良。以往談到JavascriptMVC跟Backbone的時候，其實這兩個框架的目的是不同的。
JMVC除了MVC還提供其他的case solution，而Backbone只專注在MVC身上。另外一個不同點是JMVC當時的MVC framework只能綁定在jQuery上面，Backbone可以把核心抽換成zepto(一個類似于jQuery但輕量化的js lib)，這也是有手機網頁app使用backbone卻沒有人使用jmvc的原因。</p>

<h1>CanJS</h1>

<p><a href="http://canjs.us">CanJS官網</a>
以下節錄幾個要點：</p>

<ol>
<li>核心可抽換成Zepto, jQuery, YUI, Dojo, Mootools。</li>
<li>非常快，
<img src="http://bitovi.com/images/introducing-canjs/performance_control.png">
<img src="http://bitovi.com/images/introducing-canjs/performance_livebind.png">
比較令我訝異的是backbone竟然沒有live binding功能？</li>
<li>安全的Model。jqueryMX一個缺點是常常會有內容相同的model instance，CanJS解決了這點。它保證相同內容的Object只會有一個instance。</li>
<li>View可以做live binding了，直接對應Model change。</li>
</ol>


<h1>展望</h1>

<p>以往JMVC為人詬病的就是本身提供的東西太複雜，不會有全部學完的動力。看來CanJS可以在專心這件事上趕上Backbone。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-05-30T17:33:00+08:00" pubdate data-updated="true">May 30<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/javascriptmvc/'>javascriptmvc</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/05/30/i-have-also-a-story-to-tell/">
		
			「WEB」我也有一個故事要說。</a>
	</h2>
	<div class="entry-content">
		<p>這個部落格在我的定位中是純技術取向，但這篇應該會是唯一一篇非關技術的文章。</p>

<p>文長。</p>

<p>我在確定得到新工作的那一天，在ptt soft_job以及web_design版發表了那段時間的面試心得，內容是有關前端工程師的工作面試經歷。（文章在<a href="http://www.ptt.cc/bbs/Soft_Job/M.1335873183.A.F23.html">http://www.ptt.cc/bbs/Soft_Job/M.1335873183.A.F23.html</a>）因為那篇文章我收到很多回應，也很感謝所有來信的人的鼓勵。就在明天我將要離開現在的公司然後到新公司報到，我想在這邊簡單寫下一個平凡的網頁工程師一路走來的心路歷程。一些細碎片段構成的過往。</p>

<p><img src="http://i.imgur.com/CB6eE.jpg"></p>

<h3>0</h3>

<p>我是一個普通的大學畢業生，大學混了六年才畢業。相當然爾在就業市場上只能任人魚肉，剛退伍時進入了一間要做嵌入式系統的公司。而我幾乎什麼也不會，就只有一個在學歷上跌倒的經驗而已。</p>

<h3>1</h3>

<p>如前文所講，沒寫過網頁之前我很看不起寫網頁的人。現在呢？真的覺得WEB很有意思。技術發展很快又很廣，隨便找一項鑽研都能玩很久。每天睜開眼都有新的東西產生。<b>你永遠不會覺得無聊</b>。</p>

<p>大家都知道新人就是要打雜，而寫網頁這件事本身在某些公司就是一種雜務。不幸的是在公司某些部門內，網頁都會丟給新人負責，新人來了再給新人。裡面充滿着陳舊不堪參疵不齊的程式碼，那個年代jQuery剛崛起，會看到js檔內有部分jQuery寫法，有部分是javascript原生寫法。而我第一個案子就是接手這樣的網頁開發新功能。結束之後仍然不知道自己會了什麼。</p>

<p>第二個案子是作一個很龐大的web application，而這個案子一拖就是快兩年，也是我初嘗開發網頁快樂與痛苦的來源。</p>

<h3>2</h3>

<p><img src="http://i.imgur.com/CMRWv.jpg"></p>

<p>題外話，你們知道嗎，IPAD上有一款app叫zite，它會根據你看文章的喜好來決定要給你什麼material。唯一的缺點是不支援中文，文章source都是英文，不過英文資源本來就多於中文。所以當你看完一篇在寫css hack的文章，旁邊就有選項問你喜不喜歡，順便列出跟css相關的tag給你toggle。你會收到越來越多你想要的相關知識。我有一陣子睡前會躺在床上抱著ipad看新技術文章看到睡著。</p>

<p>即使是最漫長的那段日子也是一樣。</p>

<h3>3</h3>

<p><img src="http://i.imgur.com/R7n2P.png"></p>

<p>我認為部落格的蓬勃發展很大的促進了技術分享這件事。當你遇到問題的時候你會google，而解決你的問題的通常是來自某個熱血的開發者的部落格的某篇獨門心得。我一開始只把這些部落格當成解決問題的手段，平常沒事不會去看。</p>

<p>但後來有天我突然覺得沒有他們日子會很難過，而這時候我也確定自己想走web這一塊。我開始注意每個web developer的部落格，其中提到非技術的部分。<b>很大一部分在說自己對於這一塊的熱情與期望。</b>
檯面上的技術心得文，檯面下往往是要十倍百倍於文字量的熱情支撐。</p>

<p>比如熱血的前Y!前端工程師Josephj(我從他的部落格知道F2E這個字的意義。)</p>

<p>比如版上很熱心的TonyQ大大在版上的每篇熱心文章。</p>

<p>比如我剛進前公司時發現公司裡面有個好人前輩有在經營部落格分享自己在open source的知識跟經驗，那時候就很想認識他但覺得自己不是個咖所以沒膽去搭訕認識。</p>

<p>比如這個中國人寫的部落格：<a href="http://coolshell.cn">酷殼</a>，作者是Amazon中國研發經理，
裡面的文章不一定全都跟Web相關，我第一次讀是從這篇開始：<a href="http://coolshell.cn/articles/1932.html">哥是玩程序的</a>。但後來我發現更有價值的東西不只是javascript相關的有趣文章，而是他的工作思想，是他提倡<b>將工作提升到事業層次</b>這個想法，
如：<a href="http://coolshell.cn/articles/6346.html">程序員因為女孩而美麗！</a>，<a href="http://coolshell.cn/articles/7186.html">做個環保主義的程序員</a>，<a href="http://coolshell.cn/articles/6142.html">三個事與三個問題</a></p>

<p>然後我也開始自己寫部落格，是因為有天看到某篇文章說，現在工程師面試需要的是：自己經營的技術部落格，github上的帳號等等。然後我就這麼做了，申請github帳號，先用自己的NAS架wordpress，後來覺得很難用，看到XDite等前輩在推octopress，剛好github也可以玩，就轉到github pages發展了。</p>

<p>以上這些跟我的工作其實都沒有直接關係，都是利用下班的空閒時間做的。</p>

<h3>4</h3>

<p><img src="http://i.imgur.com/V8dg6.jpg" title="有人問我這是什麼？最後一個下班者拿走鑰匙的簽名。被跳過的平常日期是：沒回家。" ></p>

<p>然後就是那個一直被傳頌的故事。</p>

<p>我不知道是不是每一間公司都有保全系統。我們公司跟中X保全簽約，每一天必須關門的時間是半夜12點。這半年來我每一天幾乎都超過12點下班，今年初變本加厲到凌晨3,4,5,6,7,8點，然後隔天依然九點半上班。我每天晚上都會打電話給中x保全說我要加班，請延長保全時間。到後來他們都知道了，只要我們公司過了半夜兩點還沒設定保全，他們會直接打電話到我私人手機問我在不在公司。</p>

<p>而我通常都在。</p>

<p>嗯，我知道你要問為什麼？</p>

<p>前公司並不是很重視WEB技術，但這個專案的規格跟複雜度遠遠超出他們的輕蔑。對當時的我來說，我覺得以自己當時的知識完全不足以開發出那個大型Web Application，但也只能硬著頭皮幹。隨著專案時間越拉越長，無止盡的會議，UI上的功能需求越改越多，越來越複雜，到我離開的時候整個網站介面翻掉了七次之多。就像OSDC中那個需求變更的lighting talk講的好，<b>權威人士握有對你的東西的最高指導權。</b>而你毫無反應，只是個底層的前端工程師。連Interface Designer都可以決定你的生死(畫一個很難實現的按鈕/對話框/視窗你就準備寫CSS寫到爽了)。到最後其實案子已經有點失控，所以我就跳出來說：「好吧，如果沒人想寫下並定好這些規格那我來寫。」</p>

<p>這是去年十月的事情，而，這是地獄的開端。</p>

<p>每天白天跟作風非常強勢的QA用電話討論UI spec細節，晚上利用空檔寫functional spec，一邊改網頁到符合spec。這段時間平均下班時間是11點~1點，直到某天公司總務發群體信說中X保全抱怨我們超過時間，我才知道原來要加班要先打電話給保全。寫了兩個月終於完成spec第一版，圖文並茂六萬字word。但是根本沒有時間去補足那千餘個功能，因為只有我一個人在做WEB。然後有趣的是上頭很急著進測，他們認為spec寫完就是完成了一切，當然不是。進測結果很糟糕，大部分是未完成功能與ui文字拼寫等UI bug。</p>

<p>我在這段期間還一邊接觸了一些新的技術，因為我想利用MVC框架來解決那些我在這個web application上遇到的種種奇特困難。案子被QA退回後，上頭重新檢討認為是spec不夠詳細嚴謹，於是兩位主管級跳下來接手spec重寫。我自己利用這段時間拼命研究各種網路上的資源。</p>

<h3>5</h3>

<p><img src="http://i.imgur.com/6FkRe.jpg"></p>

<p>我選擇的技術叫JavascriptMVC，是一個total solution client side MVC framework。與它相似的東西是Backbone.js，而最近這段期間我也體悟到其實backbone比較多人在用。也很多人問我為什麼當時不用backbone? 我的答案很簡單，當時花了兩天熬夜做不出一個簡單的起始範例，backbone的文件實在令我費解，就放棄了，</p>

<p>我並沒有太多時間。</p>

<p>當然不只backbone跟jmvc，為了解決問題我也看了YUI, extJS, 甚至zk。我還花時間研究extJS的對話框是怎樣用div拼出來的，那噁心的東西。還有我順便買了一台Synology的NAS回家研究他們怎麼做出那麼漂亮的東西。</p>

<h3>6</h3>

<p>選定JMVC之後一切就順利了嘛？當然不是。這東西在台灣甚至大陸根本沒人在用，網路上清一色都是用backbone。連英文資源也不多。我遇到問題只能到官方forum用破爛英文問作者這功能是什麼？還被嫌棄過我寫的字句他看不懂:D</p>

<p>斷斷續續利用工作空檔時間看jmvc doc兩三個月之後我終於動手對那個改不動的噁心網頁做了refactor。整個砍掉重寫。這次花了三個月的時間寫了五萬行code。重點是，主管並不支持我做重構這件事。而我認為不重構的話某些該死的複雜功能根本無以實現。</p>

<p>我們的想法有衝突，而<b>我只是個想把這件事情做好的死心眼的傢伙。</b>我就在幾乎得不到任何support的情況下開始了進階版的地獄：平均下班時間延長到凌晨兩三點。有段時間每個禮拜會有一天通宵然後隔天不請假繼續上班。</p>

<p>支持我的信念只是相信自己辦的到。但，我曾有很多次在凌晨四五點回到家，洗澡的時候跌坐在地上任熱水沖淋，問自己「這一切到底有何意義？」即使是現在，我也不認為自己是因為那段時間的拼命而獲得一份好的工作，你知道的，努力跟回報從來都不是成正比。但當你真心愛某件事，過程才是重點。</p>

<h3>7</h3>

<ul>
<li>最痛苦的事情不是每天加班，而是你的主管在這段期間不但沒幫你，還處於某種狀況之下導致常常對自己發動言語精神攻擊。</li>
<li>畢竟我只是個人微言輕的小工程師，沒有拿出成果之前，一切都是白搭，不管你多有熱情，對其他人來說「做不到」他們要的東西，你講話就不會有分量。</li>
<li><p>「孤立無援」是一句成語，可以用來造句。對我來說是殘酷的現實。因為最後實做的人是你，不管你有什麼困難，都是你家的事。不管你<code>rhino debugger多難用Makefile多難寫dir-based namespace pattern多難改resize event delegation在IE8出了什麼問題收不到對話框多難刻用js模擬dbus請求多難搞同時採用不同來源data model並行多難做多重ActiveX callback多難整按鈕不同尺寸css sprite多難寫</code>，別人只看得到UI最後的模樣，你做不出來就是你無能，你說做得出來就是「不管我壓什麼時間都做得出來」。</p>

<p>  「你到底有沒有珍惜這份工作？」某天晚上七點主管把我叫進會議室檢討。他不滿意我的進度，給了我很爛的評價。
  你知道眼前坐在椅子上不發一語的我，昨天趕你要的東西沒睡覺嗎？
  我就算不是你最強的員工，也是你最拼命的員工，你該珍惜的不是別人給你的案子的評價，而是身為你員工的我。</p></li>
</ul>


<h3>8</h3>

<p>然後我趕上了不可能的deadline，終於覺得累了，  release的隔天我便打開104更新履歷然後放著。</p>

<h3>9</h3>

<p>原本只是想換一間重視技術也重視web的公司待，沒有預期自己一定會去哪。收到Mozilla的面試邀約，我很驚訝他們有要找Frontend，當然被他們錄取我更suprise。直到現在我依然不得不壓抑自己內心的激動，畢竟，那可是Mozilla。身為一個F2E Newbie，竟然可以在那邊跟全世界的高手們cowork，並且有機會見到一些此領域的大師級人物（jQuery的創始者John Resig曾經待過Mozilla）。</p>

<p>而Mozilla本身想要做某些事情來改變網際網路的未來讓網路變得更好，而，改變網路就幾乎等於著手<u>改變這個世界的未來。</u></p>

<p>有幸參與這個過程，怎能叫人不興奮？</p>

<p>但，你知道的，激情並不是能永久持續的狀態。我現在必須努力把這份激動壓抑下來，然後希望自己永遠莫忘初衷。</p>

<br/>


<p>以上是一個剛起步的小小前端工程師的一段經歷，希望對讀到這篇文章的人有幫助。</p>

<p>Alive Kuo@20120530</p>

<h1>Q&amp;A</h1>

<ol>
<li>有人問第4段的那張手寫日期表是什麼？最後一個下班者拿走公司鑰匙的簽名。被我懶得寫跳過的平常日期是：沒回家。假日來公司：不會記。</li>
</ol>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-05-30T04:15:00+08:00" pubdate data-updated="true">May 30<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/web/'>web</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/05/24/javascriptmvc-slideshare/">
		
			JavascriptMVC on Slideshare</a>
	</h2>
	<div class="entry-content">
		<p>陸續看到兩個介紹Backbone的投影片&#8211;JSDC上的<a href="https://speakerdeck.com/u/jaceju/p/refactoring-with-backbonejs">Refactor with Backbone.js</a>，以及在slideshare看到的<a href="http://www.slideshare.net/molily/javascript-application-architecture-with-backbonejs">Javasciprt Application Architecture with Backbone.js</a>，一時手癢就想自己也來做一個介紹JavascriptMVC的投影片丟到Slideshare。</p>

<p>目前Slideshare上跟JavascriptMVC有關的投影片有：</p>

<ol>
<li><a href="http://www.slideshare.net/4lb0/javascriptmvc">JavascriptMVC</a>:六個月前上傳，德文？撰寫。</li>
</ol>


<div style="width:425px" id="__ss_10174435"> <strong style="display:block;margin:12px 0 4px"><a href="http://www.slideshare.net/4lb0/javascriptmvc" title="JavascriptMVC" target="_blank">JavascriptMVC</a></strong> <iframe src="http://www.slideshare.net/slideshow/embed_code/10174435" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen></iframe></div>


<ol>
<li><a href="http://www.slideshare.net/zukunftsalick/introduction-to-javascriptmvc">Introduction to JavascriptMVC</a>:一年前上傳。</li>
</ol>


<div style="width:425px" id="__ss_7966052"> <strong style="display:block;margin:12px 0 4px"><a href="http://www.slideshare.net/zukunftsalick/introduction-to-javascriptmvc" title="Introduction to JavaScriptMVC" target="_blank">Introduction to JavaScriptMVC</a></strong> <iframe src="http://www.slideshare.net/slideshow/embed_code/7966052" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen></iframe></div>


<ol>
<li><a href="http://www.slideshare.net/tdreyno/jqconf">Organizing Code with JavascriptMVC</a>:兩年前上傳。</li>
</ol>


<div style="width:425px" id="__ss_5467723"> <strong style="display:block;margin:12px 0 4px"><a href="http://www.slideshare.net/tdreyno/jqconf" title="Organizing Code with JavascriptMVC" target="_blank">Organizing Code with JavascriptMVC</a></strong> <iframe src="http://www.slideshare.net/slideshow/embed_code/5467723" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen></iframe></div>


<p>比起Backbone實在差太多了&#8230;而且有些還是過時的資訊。</p>

<p>姑且先整理一下之前的Javascript簡介投影片丟上去，下個目標預計是寫一個完整的建置範例，不過目前還沒有想到主題。</p>

<div style="width:425px" id="__ss_13010920"> <strong style="display:block;margin:12px 0 4px"><a href="http://www.slideshare.net/DavidSkyAlive/javascriptmvc-another-choice-of-web-framework" title="JavascriptMVC: Another choice of web framework" target="_blank">JavascriptMVC: Another choice of web framework</a></strong> <iframe src="http://www.slideshare.net/slideshow/embed_code/13010920" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen></iframe> <div style="padding:5px 0 12px"> View more <a href="http://www.slideshare.net/" target="_blank">presentations</a> from <a href="http://www.slideshare.net/DavidSkyAlive" target="_blank">Alive Kuo</a> </div> </div>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-05-24T14:58:00+08:00" pubdate data-updated="true">May 24<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/javascriptmvc/'>javascriptmvc</a>


</div>
	
</div></article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Alive Kuo

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'ascheriit';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-29151691-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>